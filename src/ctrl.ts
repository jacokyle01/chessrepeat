import { Api } from 'chessground/api';
import { NewSubrepertoire, PgnViewContext, Redraw } from './types/types';
import { ChessSrs } from 'chess-srs';
import { initial } from 'chessground/fen';
import { Key } from 'chessground/types';
import { Config as CgConfig } from 'chessground/config';
import { calcTarget, chessgroundToSan, fenToDests, toDestMap } from './util';

export default class PrepCtrl {
  //TODO call these "plans"
  subrepertoireNames: string[] = [];
  numDueCache: number[] = [];

  //libraries
  chessground: Api | undefined; // stores FEN

  chessSrs = ChessSrs({
    buckets: [1, 11, 111],
    getNext: {
      by: 'depth',
      max: 10
    },
  }); //stores training data

  addingNewSubrep = false;

  // lastFeedback: 
  lastFeedback: 'init' | 'learn' | 'recall' | 'fail' | 'alternate' = 'init';


  // necessary context to display PGN, either as tree or chessground
  pgnViewContext: PgnViewContext = {
    splitFen: null,
    index: -1,
  };

  path: string[] = []; // array of FEN strings
  pathIndex: number = -1;

  constructor(readonly redraw: Redraw) {
    //we are initially learning
    document.addEventListener('DOMContentLoaded', (_) => {
      this.chessSrs.setMethod('learn');
      this.addSubrepertoire({
        pgn: '1. d4 d5 2. c4 e6 3. Nf3 Nf6 4. g3 dxc4 5. Bg2 Bb4+ 6. Bd2 a5 {Defending the bishop} 7. Qc1 Bxd2+ {Black trades bishops} 8. Qxd2 {White recaptures with the queen} b5 {Defending the pawn} 9. Qg5 b4 10. Rg1 Rg8 11. Rh1 Rh8 a3 Ra7',
        alias: 'catalan',
        trainAs: 'white',
      });

      this.addSubrepertoire({
        pgn: '1. d4 d5 2. c4 e6 3. Nf3 Nf6 4. g3 dxc4 5. Bg2 Bb4+ 6. Bd2 a5 7. Qc1 Bxd2+ 8. Qxd2 b5 9. Qg5',
        alias: 'catalan2',
        trainAs: 'white',
      });

      this.addSubrepertoire({
        pgn: '1. d4 d5 2. c4 e6 3. Nf3 Nf6 4. g3 dxc4 5. Bg2 Bb4+ 6. Bd2 a5 7. Qc1 Bxd2+ 8. Qxd2 b5 9. Qg5',
        alias: 'catalan3',
        trainAs: 'white',
      });
      this.addSubrepertoire({
        pgn: "1.e4 e5 2.Nf3 Nc6 ( 2...d6 { Test } 3.d4 { White immediately challenges Black in the centre. } ) ( 2...Qe7 {  } 3.Bc4 { White puts pressure on f7 and plans to castle quickly, before opening the centre with d2-d4. } 3...d6 4.O-O ) 3.Bb5 a6 ( 3...Nf6 4.d3 Bc5 ( 4...d6 5.O-O Bd7 ( 5...Be7 6.h3 O-O ( 6...a6 7.Bxc6+ bxc6 8.Nc3 ) 7.c4 ) ( 5...g6 6.d4 Bd7 ( 6...exd4 7.e5 dxe5 8.Nxe5 ) 7.d5 ) ( 5...a6 6.Bxc6+ bxc6 7.Re1 Be7 ( 7...c5 8.c3 {[%cal Gd3d4]} ) 8.d4 { Transposes to Averbakh Variation } ) 6.Re1 g6 7.d4 Bg7 8.d5 Ne7 9.Bxd7+ Nxd7 ) ( 4...Bd6 5.O-O ) ( 4...Ne7 5.Bc4 {[%cal Rf3e5][%csl Re5]} c6 6.Nc3 ) 5.Bxc6 dxc6 ( 5...bxc6 6.Nxe5 ) 6.Qe2 ( 6.Nc3 Qe7 7.h3 Bd7 ( 7...h6 8.Be3 ) 8.Qe2 O-O-O ) 6...Nd7 ( 6...Qe7 7.Nbd2 O-O 8.Nc4 ) ( 6...Bg4 7.h3 Bxf3 8.Qxf3 ) ( 6...Bd6 7.Nbd2 ) 7.Nbd2 O-O 8.Nc4 Re8 9.h4 b5 10.Ne3 Nf8 11.a4 ) ( 3...Qf6 4.O-O ) ( 3...f5 4.d3 fxe4 ( 4...Nf6 5.exf5 Bc5 ( 5...d6 6.O-O Bxf5 7.d4 ) 6.O-O O-O 7.Be3 Nd4 8.c3 ) ( 4...d6 5.exf5 Bxf5 6.d4 ) 5.dxe4 Nf6 6.O-O Bc5 ( 6...d6 7.Bc4 {[%cal Gf3g5][%csl Gg5]} Bg4 8.h3 Bh5 9.Nc3 Qd7 10.Nd5 O-O-O 11.Qd3 Kb8 12.b4 ) 7.Qd3 ( 7.Bxc6 bxc6 8.Nxe5 O-O 9.Nc3 d6 ( 9...Ba6 10.Nd3 Bb6 11.Bg5 ) 10.Na4 Qe8 11.Nd3 Bg4 12.Qe1 Bd4 13.c3 Bb6 14.Nxb6 axb6 15.f3 Be6 16.a3 Bc4 17.Qd1 ) 7...d6 ( 7...Nd4 8.Nxd4 Bxd4 9.Bc4 ) ( 7...Qe7 8.Nc3 ) ( 7...O-O 8.Qc4+ ) 8.Qc4 Qe7 ( 8...Bd7 9.Nc3 Qe7 ) 9.Nc3 Bd7 ( 9...a6 10.Bxc6+ bxc6 11.Be3 ) 10.Nd5 Nxd5 11.exd5 { Transposes. } 11...Nd4 12.Bxd7+ Qxd7 13.Nxe5 Qf5 14.Nd3 O-O-O 15.Kh1 ) ( 3...Nd4 4.Nxd4 exd4 5.O-O Bc5 ( 5...c6 6.Bc4 Nf6 ( 6...d5 7.exd5 cxd5 8.Bb5+ Bd7 9.Re1+ Ne7 10.c4 ) 7.d3 d5 8.exd5 Nxd5 9.Re1+ ) 6.Bc4 d6 7.d3 Ne7 8.f4 ) ( 3...Nge7 4.Nc3 ( 4.O-O ) ( 4.d4 exd4 5.Nxd4 Nxd4 ( 5...g6 6.Nxc6 Nxc6 ( 6...bxc6 7.Qd4 { This is the point of Bxc6. In reality, Black would rather capture this way to prepare d5. } ) 7.Nc3 Bg7 8.Be3 ) ( 5...Ng6 6.Be3 { Makes Bc5 less appetizing. } 6...Be7 7.Nc3 O-O 8.h4 ) 6.Qxd4 Nc6 7.Qe3 Be7 8.Nc3 O-O 9.O-O ) 4...g6 ( 4...d6 5.d4 a6 ( 5...Bd7 6.d5 ) ( 5...exd4 6.Nxd4 ) 6.Bc4 ) ( 4...Ng6 5.d4 exd4 6.Nxd4 Bc5 7.Be3 ) ( 4...a6 5.Bc4 Ng6 6.d4 ) 5.d4 exd4 ( 5...Bg7 6.dxe5 ) 6.Nd5 Bg7 ( 6...Nxd5 ) 7.Bg5 h6 8.Bf6 Bxf6 ( 8...Kf8 9.Bxg7+ Kxg7 10.Bxc6 Nxc6 11.Qd3 ) 9.Nxf6+ Kf8 10.Qd2 d5 ( 10...Ng8 11.Nxg8 Kxg8 12.O-O-O ) ( 10...a6 11.Bc4 Ng8 12.Nd5 ) ( 10...d6 11.O-O-O ) 11.Bxc6 Nxc6 12.Nxd5 Bf5 13.Qf4 Bxe4 14.Qxe4 Qd6 15.Nxc7 Qxc7 16.O-O-O Re8 17.Qh4 ) ( 3...g6 4.c3 ( 4.d4 exd4 5.Bg5 Be7 6.Bxe7 Qxe7 7.Bxc6 dxc6 8.Qxd4 Nf6 9.Nc3 Bg4 10.O-O-O { This, to allow Bxf3, is the new move. } 10...Bxf3 11.gxf3 O-O 12.Qe3 Nh5 ) ( 4.O-O ) 4...a6 ( 4...d6 ) ( 4...Nge7 5.d4 exd4 6.cxd4 d5 7.exd5 Nxd5 8.O-O Bg7 9.Re1+ Be6 10.Bg5 Qd6 11.Nbd2 O-O 12.Ne4 Qb4 13.Bxc6 bxc6 14.Qc1 Rfe8 15.Bd2 Qb6 16.Nc5 Bf5 17.Ne5 ) ( 4...Bg7 ) 5.Ba4 Bg7 ( 5...d6 { Transposes } ) ( 5...Nge7 { Transposes } ) 6.d4 exd4 7.cxd4 b5 8.Bc2 d6 9.d5 Na5 10.O-O ) ( 3...Bc5 4.c3 Nf6 ( 4...f5 5.d4 fxe4 6.Bxc6 dxc6 7.Nxe5 Bd6 8.Qh5+ g6 9.Qe2 Bf5 ( 9...Qh4 10.h3 ) 10.Bf4 Nf6 11.Nd2 ) ( 4...Qf6 5.O-O Nge7 6.Re1 ) ( 4...Bb6 5.d4 exd4 6.cxd4 Nce7 7.O-O c6 8.d5 cxb5 9.d6 ) ( 4...Nge7 5.O-O Bb6 6.d4 exd4 7.cxd4 d5 8.exd5 Nxd5 9.Re1+ Be6 10.Bg5 Qd6 11.Nbd2 O-O 12.Nc4 Qb4 13.a4 ) 5.d4 exd4 ( 5...Bb6 $6 6.Nxe5 Nxe5 7.dxe5 Nxe4 8.Qg4 Bxf2+ 9.Ke2 Qh4 10.Qxg7 Rf8 11.Bh6 Bc5 12.Nd2 Qf2+ 13.Kd1 Nxd2 14.Bxd2 ) 6.e5 Nd5 ( 6...Ne4 7.O-O d5 ( 7...dxc3 $6 8.Qd5 ) 8.cxd4 Bb6 9.Nc3 ) 7.O-O Be7 ( 7...O-O $6 8.cxd4 ) 8.cxd4 d6 9.exd6 ) ( 3...Bb4 4.c3 Ba5 5.Qa4 Bb6 6.d4 ) ( 3...d6 4.d4 { Gaining space with 4.d5 Nce7 5.c4 should be very good for White also, as he has control over the entire centre. } 4...exd4 ( 4...Bd7 5.Nc3 { Transposes } 5...Nge7 ) ( 4...Bg4 5.dxe5 dxe5 6.Qd5 ) 5.Nxd4 Bd7 6.Nc3 Nf6 ( 6...g6 { 6...Nf6 transposes to avariation considered under the move order @@StartFEN@@rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1@@EndFEN@@ 1.e4 d6 2.d4 Nf6 3.Nc3 e5 4.Nf3 exd4 . As you can see, transpositions can happen in the Philidor quite regularly. Here White has many different replies to get a good position. } 7.Be3 Bg7 8.Qd2 Nf6 9.Bxc6 bxc6 10.Bh6 O-O 11.Bxg7 Kxg7 12.O-O-O ) ( 6...Nxd4 7.Bxd7+ Qxd7 8.Qxd4 ) 7.O-O Be7 { Transposes } 8.Nxc6 Bxc6 ( 8...bxc6 9.Bd3 O-O 10.f4 ) 9.Bxc6+ bxc6 10.f4 ) 4.Ba4 Nf6 ( 4...b5 5.Bb3 Na5 ( 5...Nf6 6.O-O ) ( 5...Bb7 6.d4 exd4 7.O-O Na5 8.Qxd4 d6 9.Bg5 ) ( 5...g6 6.d4 exd4 7.Nxd4 Na5 8.a4 b4 9.Ba2 Bg7 10.O-O Ne7 11.c3 ) ( 5...Bc5 6.c3 { As is often recommended with a bishop on c5. } 6...d6 7.d4 exd4 8.cxd4 Bb6 9.Nc3 Bg4 10.Be3 Nf6 11.Nd5 Nxe4 $4 12.Nxb6 ( 12.Qc2 ) 12...cxb6 13.Qc2 ) ( 5...d6 6.a4 { We are in Noah's Ark trap territory, so it is good to avoid d4. } 6...b4 7.d4 ) ( 5...Be7 6.d4 exd4 7.c3 { This move works well due to a tactical subtlety. } 7...dxc3 $4 ( 7...Na5 8.Qxd4 Nxb3 9.axb3 ) 8.Qd5 ) 6.O-O d6 ( 6...Nxb3 7.axb3 d6 8.d4 ) 7.d4 exd4 ( 7...Nxb3 8.axb3 f6 ( 8...exd4 9.Nxd4 Bb7 10.Re1 ) 9.Nc3 Bb7 10.Qd3 {[%cal Gf1d1,Gc3d5][%csl Gd1,Gd5]} ) ( 7...f6 8.Bxg8 Rxg8 9.a4 ) 8.Re1 { A rare move. } 8...Nxb3 ( 8...Bb7 9.c3 ) ( 8...c5 9.Bd5 ) 9.axb3 c5 10.c3 Be7 11.cxd4 Nf6 12.Nc3 ) ( 4...f5 5.d4 exd4 ( 5...fxe4 6.Nxe5 Nf6 7.O-O Bd6 8.Nc3 ) 6.e5 Bc5 ( 6...b5 7.Bb3 Bb7 ) 7.O-O Nge7 8.c3 dxc3 9.Nxc3 d5 ( 9...O-O 10.Nd5 ) 10.Bg5 ) ( 4...Nge7 5.c3 ( 5.d4 exd4 ( 5...b5 6.Bb3 exd4 7.Nxd4 Nxd4 8.Qxd4 ) 6.Nxd4 Nxd4 7.Qxd4 b5 ( 7...Nc6 8.Qd3 ) 8.Bb3 Nc6 ( 8...Bb7 9.O-O Nc6 10.Qd3 ) ) 5...g6 { Transposes } ( 5...d6 6.d4 Bd7 7.d5 Nb8 8.Bxd7+ ) ( 5...Ng6 6.d4 ) 6.d4 exd4 7.cxd4 b5 ( 7...Bg7 8.d5 Na5 $6 ( 8...b5 9.Bc2 { Transposes } ) 9.Bd2 ) 8.Bc2 d5 ( 8...Bg7 9.d5 { Transposes } 9...Na5 ( 9...Nb4 10.Bb3 a5 11.a3 Na6 12.O-O ) 10.Bd2 {[%cal Gd2c3,Gc3a5][%csl Gc3,Ga5]} c5 ( 10...Nc4 11.Bc3 Bxc3+ 12.Nxc3 d6 13.Qc1 {[%cal Gc1h6][%csl Gh6]} ) 11.Bc3 ) 9.exd5 Nxd5 ( 9...Nb4 10.Bb3 Nbxd5 11.O-O Bg7 12.Bg5 Qd6 13.Nbd2 ) 10.O-O ) ( 4...g6 5.d4 exd4 ( 5...b5 6.Bb3 ) 6.Nxd4 Bg7 7.Nxc6 bxc6 ( 7...dxc6 8.Qxd8+ Kxd8 9.Bb3 ) 8.O-O Ne7 9.Nc3 O-O ) ( 4...Bc5 5.c3 Nge7 ( 5...Nf6 6.d4 Ba7 7.O-O ) 6.O-O ( 6.d3 ) ( 6.d4 exd4 7.cxd4 Bb4+ 8.Nc3 d5 9.O-O dxe4 10.Nxe4 O-O ) 6...Ng6 7.d4 Ba7 8.Bg5 f6 9.Be3 O-O 10.Nbd2 ) ( 4...d6 5.O-O { The inclusion of a6 proves favorable for Black, as 5. d4 ran into b5 Bb3 cxd4 and White cannot recapture due to the Noah's Ark trap. } 5...Bd7 ( 5...Nf6 { Steinitz Deferred } ) ( 5...Bg4 6.h3 h5 ( 6...Bh5 7.c3 Nf6 8.d4 ) 7.Bxc6+ bxc6 8.d4 Bxf3 ( 8...Qf6 9.Nbd2 g5 10.dxe5 dxe5 11.Nc4 ) 9.Qxf3 exd4 10.Re1 Qf6 11.Qb3 Ne7 12.Qb7 Rc8 13.Nd2 ) 6.c3 g6 ( 6...g5 7.d4 g4 8.Ne1 h5 9.f4 exd4 10.cxd4 d5 11.Nd3 {[%cal Gd3e5][%csl Ge5]} dxe4 12.Ne5 ) ( 6...Nf6 7.Re1 { Modern Steinitz } ) ( 6...Nge7 7.d4 Ng6 8.d5 Nb8 9.Bxd7+ Nxd7 10.c4 Be7 11.Nc3 O-O ) 7.d4 Bg7 8.h3 Nf6 ( 8...b5 9.Bc2 ) 9.Re1 { Transposes } ) ( 4...Be7 5.O-O ) 5.O-O Be7 ( 5...Nxe4 6.d4 ( 6.Re1 ) 6...b5 ( 6...Be7 7.Re1 b5 ( 7...f5 8.Nxe5 Nxe5 9.dxe5 ) 8.Rxe4 d5 9.Nxe5 Nxe5 10.Rxe5 bxa4 11.Qe2 ) ( 6...exd4 7.Re1 d5 8.Nxd4 Bd6 9.Nxc6 Bxh2+ 10.Kh1 Qh4 11.Rxe4+ dxe4 12.Qd8+ Qxd8 13.Nxd8+ Kxd8 14.Kxh2 Be6 15.Be3 f5 16.Nd2 ) 7.Bb3 d5 8.dxe5 Be6 9.Qe2 Bc5 ( 9...Be7 10.Rd1 ( 10.c3 O-O ( 10...Nc5 11.Bc2 ) 11.Bc2 Qd7 12.Nbd2 ) 10...O-O ( 10...Nc5 11.Nc3 Nxb3 12.cxb3 O-O 13.Be3 Qd7 14.Rd2 ) ( 10...Na5 11.c3 Nxb3 12.axb3 O-O 13.Nd4 ) 11.c3 Qd7 ( 11...Nc5 12.Bc2 Bg4 13.Nbd2 ) 12.Nbd2 ) ( 9...Nc5 10.Rd1 Nxb3 11.axb3 Be7 12.c4 b4 13.Nbd2 ) 10.Nbd2 Nxd2 ( 10...Bf5 11.Nxe4 Bxe4 12.a4 ) 11.Bxd2 O-O 12.c3 ( 12.Rad1 Bg4 ) ) ( 5...Bc5 6.c3 b5 ( 6...O-O 7.d4 Ba7 8.Re1 ( 8.Bg5 h6 ( 8...exd4 9.cxd4 h6 10.Bh4 ) 9.Bh4 exd4 ( 9...d6 10.Bxc6 bxc6 11.Nbd2 ) 10.cxd4 d6 11.Nc3 ) 8...d6 ( 8...b5 9.Bc2 ) 9.h3 b5 10.Bc2 h6 11.Be3 Re8 12.Nbd2 Bb7 13.a3 ) 7.Bc2 d5 ( 7...d6 8.d4 Bb6 9.a4 Bg4 10.h3 Bh5 11.d5 Ne7 12.axb5 axb5 13.Rxa8 Qxa8 14.Na3 ) 8.a4 ( 8.Nxe5 Nxe5 9.d4 dxe4 10.dxe5 Qxd1 11.Rxd1 Ng4 12.Bxe4 Nxf2 13.Bc6+ Ke7 14.Rd5 Bb6 15.Bg5+ f6 16.exf6+ gxf6 17.Bh4 Ng4+ 18.Kh1 Rb8 19.Nd2 Be6 20.Rh5 Nf2+ 21.Bxf2 Bxf2 22.Rf1 Be3 23.Ne4 ) 8...dxe4 9.axb5 exf3 ( 9...Bg4 10.bxc6 exf3 11.gxf3 Bh3 12.Re1 O-O 13.Ra5 ) 10.Qxf3 e4 11.Bxe4 Ne5 12.Qe2 O-O 13.d4 Bg4 14.Qc2 Nxe4 15.Qxe4 Nf3+ 16.gxf3 Bh3 17.dxc5 ) ( 5...b5 6.Bb3 Bb7 ( 6...Bc5 7.a4 ( 7.c3 d6 8.d4 Bb6 9.Be3 { Has a better winrate, and appears to be simpler than a4. } ( 9.a4 Bg4 10.h3 Bh5 ) 9...O-O ( 9...Bg4 10.Nbd2 O-O ( 10...exd4 11.cxd4 Nxd4 12.Bxd4 Bxd4 13.Bxf7+ Kxf7 14.Qb3+ Kf8 15.Nxd4 ) 11.h3 Bh5 12.dxe5 Nxe5 13.Bxb6 cxb6 14.g4 Bg6 15.Nd4 ) 10.Nbd2 h6 ( 10...Re8 11.h3 ) 11.h3 Re8 12.Re1 exd4 13.cxd4 Nb4 14.Qe2 ) 7...Rb8 ( 7...Bb7 8.c3 d6 9.d4 Bb6 10.Re1 { Transposes } ( 10.a5 Nxa5 11.Rxa5 Bxa5 12.dxe5 dxe5 13.Nxe5 ) ) ( 7...b4 8.Nxe5 Nxe5 9.d4 Bxd4 10.Qxd4 ) 8.c3 d6 ( 8...O-O 9.d4 Bb6 10.dxe5 Ng4 11.a5 Ba7 12.Bf4 Qe7 13.e6 dxe6 14.e5 ) 9.d4 Bb6 10.a5 { Black will face many problems from allowing a5. } 10...Ba7 ( 10...Bxa5 11.d5 ) ( 10...Nxa5 11.Rxa5 Bxa5 12.dxe5 ) 11.h3 { White cannot allow Black's LSB to put pressure on his center. } 11...O-O ( 11...Bb7 {[%cal Rf6e4][%csl Re4]} 12.Be3 { Setting up a myriad of problems relating to d5 and the pressure on e5. Already d5 is a threat. } 12...Nxe4 13.Re1 exd4 14.cxd4 Ne7 15.Nbd2 d5 16.Rc1 ) ( 11...h6 12.Be3 { Setting up a myriad of problems relating to d5 and the pressure on e5. Already dxe5 is a threat. } 12...Ra8 13.Re1 O-O 14.Nbd2 ) 12.Be3 { Setting up a myriad of problems relating to d5 and the pressure on e5. Already dxe5 is a threat. } 12...Ra8 ( 12...exd4 13.cxd4 Nb4 ( 13...Nxe4 14.Qc2 ( 14.Bd5 Qe8 15.Re1 Nf6 16.Bg5 Nxd5 17.Rxe8 Rxe8 18.Nc3 ) 14...Qe8 15.Nc3 ) 14.Nc3 Bb7 15.Ng5 ) ( 12...Re8 13.Ng5 Rf8 14.Re1 ) ( 12...Nxe4 13.Bd5 exd4 14.cxd4 ) 13.Nbd2 h6 ( 13...Re8 14.Re1 ) ( 13...Bb7 14.Re1 ) 14.Re1 ( 14.Qe2 ) 14...Re8 15.Qc2 { Preparing to swing the knight to f1 when e4 is defended. } 15...exd4 { cxd4 there is Nb4 soon } 16.Bxd4 ) ( 6...Nxe4 { This is not the Open Ruy, because the inclusion of b5 Bb3 means that Black cannot meet Re1 with Nc5. } 7.Re1 d5 ( 7...Nc5 8.Bd5 ) 8.Nc3 Nxc3 9.dxc3 Be6 10.a4 b4 11.a5 ) ( 6...Be7 7.Re1 ) ( 6...d6 7.c3 Na5 ( 7...Be7 8.Re1 { Transposes } ) 8.Bc2 c5 9.d4 Qc7 10.d5 ) 7.Re1 ( 7.d3 { Solidly protecting e4. } 7...Be7 ( 7...Bc5 8.a4 ( 8.Be3 d6 9.Bxc5 dxc5 10.a4 O-O ) 8...O-O ( 8...d6 ) ( 8...b4 ) ) ( 7...Bd6 8.a4 O-O 9.Nc3 b4 10.Ne2 Na5 11.Ba2 h6 12.Ng3 Re8 13.Nh4 ) 8.c4 bxc4 ( 8...O-O 9.Nc3 bxc4 10.Bxc4 ) ( 8...b4 9.Ba4 d6 10.d4 O-O 11.d5 ) ( 8...d6 9.Nc3 bxc4 10.Bxc4 O-O ) 9.Bxc4 O-O 10.Nc3 d6 11.a3 Nd4 12.Be3 c5 13.Rb1 ) 7...Be7 { Trajkovic counterattack } { Transposes to Trajkovic } ( 7...Bc5 8.c3 d6 ( 8...O-O ) ( 8...Bb6 9.d4 O-O 10.Be3 ) 9.d4 ( 9.d3 ) 9...Bb6 10.a4 { Transposes } ( 10.Be3 O-O 11.Nbd2 ) 10...O-O ( 10...h6 11.Be3 exd4 ( 11...O-O 12.d5 ) ( 11...Ng4 12.Bd5 Nxe3 13.fxe3 ) 12.cxd4 Na5 13.Bc2 ) 11.Bg5 h6 12.Bh4 exd4 ( 12...g5 13.Nxg5 hxg5 14.Bxg5 ) ( 12...Re8 13.axb5 axb5 14.Rxa8 Bxa8 15.d5 ) 13.cxd4 g5 14.Nxg5 hxg5 15.Bxg5 Nxd4 16.Bd5 ) ) ( 5...d6 { Steinitz Deferred } 6.Re1 b5 ( 6...Bg4 7.c3 Be7 { Averbakh Variation } ) ( 6...Bd7 7.c3 { Modern Steinitz } 7...Be7 ( 7...g6 8.d4 Bg7 9.h3 { Transposes } 9...O-O 10.Bc2 Nh5 {[%cal Gf7f5]}",
        alias: 'ruylopez',
        trainAs: 'white',
      });

      this.addSubrepertoire({ pgn: "1. e4 { Hello everyone! First of all, thank you for checking out my 1. e4 Lifetime Repertoire for White. My goal here is to provide the student with a complete set of variations that will hopefully be good enough to last a lifetime! Chessable What made me decide to make this repertoire series? I had such a pleasant experience working on my first Chessable course for Fischer Random Chess that it was easy to persuade me to do another one! I also decided to make the 1. e4 Repertoire series because I wanted to explore it a bit more. I used Correspondence Database, Mega Database, and researched the latest games as a reference for this repertoire. For analyses, I mostly used the engine asmFish @@StartBracket@@which is a port of Stockfish@@EndBracket@@. Take Control As you can see from the size of the course, this is a tremendous amount of work but hopefully, the results will be as beneficial to you as they were to me. 1. e4 is the most popular first move for White and the reason is clear. With e4, we immediately take control of the very center of the board, and we fight for the initiative right at the beginning of the game. I tried to make the repertoire as cohesive as possible, to make it easier to learn. I want to stress that understanding is more important than memorization. It will be good to know the typical plans and ideas, where to put the pieces, how to improve your position and so on. Chess improvement is a continuous learning process, and there are no shortcuts. To get the most out of this repertoire series, the student should not rush, and instead, try to grasp the ideas behind the moves. Increase your understanding with 1. e4 openings. Study model games, study the classics! Play seriously, analyse your games and learn from your mistakes! Understand the essence and ideas behind your variations. Do not rely on memorization. Opening variations come and go, novelties and new computer engines are always updated, but your chess strength and understanding is permanent! It does not matter one bit if you can get an advantage out of the opening, but always fail to convert. Openings are just the first step towards getting good results and improving your rating. About Me I learned chess at the age of six. Back then I was relying on chess books for computer engines were not nearly as strong they are now. I became a Grand Master at the age of 14 which made me seventh youngest at the time. I achieved my highest rating of 2822 during the first half of 2017. It was good enough for #2 in the world back then. My greatest tournament victories were the Fischer Random World Championship and maybe my Olympiad performance in 2016... there have been several other events memorable for various reasons and not just because I won. Early Influences Let me confess that until I was about 15 years I exclusively played 1. e4. After all, it is 'Best by Test' according to Bobby Fischer! The first chess book I ever read was Chess Openings: Traps and Zaps by Bruce Pandolfini and it showed some aggressive openings starting with 1. e4 which very much impressed me. Some of my favourite early books were Attacking with 1. e4 (Emms) , I probably read this book 10 times over from cover to cover!, Beating the Sicilian (Nunn and Gallagher) and The Chess Advantage in Black and White (Kaufman) 2004 (!) version. These books helped tremendously in shaping my style, back in the days when computers were not helpful for preparation. I also read Opening for White according to Anand (all 14 of them!) which was written by GM Alexander Khalifman. That was the basis of my repertoire when I was a teenager. It was the best opening series out there at the time. It's a bit outdated now, but still a great book. Some of these made it to my repertoire as well, in some lines. For example, my recommendation against the Philidor, the Alekhine or the French 3. Nd2 have been recommended in some past opening books. But in general, I prefer to choose the variations myself without getting swayed by other manuals. Lead by Example I play 1. e4 in a majority of my games. Especially this year 2020, where most of the games are being held online. There are less tabiyas than on other first move openings, and I can guess better which openings are going to happen on the board. However, on a competitive level, it is important to switch between several openings, because computers are very strong nowadays! They can analyse all the way to a clear draw easily. And the surprise factor is a very important and underrated competitive tool. A well-prepared surprise can be psychologically unpleasant to face, as the opponent has to rely on his skills and not on memory which less and less players are prepared to do these days. I can definitely use my recommendations in my own games too! I am pretty confident about the stability and validity of the lines I chose in this 1. e4 repertoire series. Confident enough to play it against anybody. I have played it already in smaller online events, and practice games and I can say that I am very pleased with the results out of the opening. I hope I can lead by example, and make this repertoire work against the strongest players in the world, when I get the chance to compete against them. It's Your Turn I'm not necessarily saying that White gets an advantage in every single line, but in general, I can assure you that you'll most likely get positions that are easier to play, or ones in which hopefully you find yourself on some familiar ground. Over the years millions of games have been played, but even now there are still improvements to be found for both sides. This is my first repertoire recommendation and I'll be happy if it stands the test of time. Over my career, I have played many games with 1. e4 and I hope you will have as much fun playing it as I have! Wesley So, Minnetonka, Minnesota August 2020 } { Hello everyone! First of all, thank you for checking out my 1. e4 Lifetime Repertoire for White. My goal here is to provide the student with a complete set of variations that will hopefully be good enough to last a lifetime! Chessable What made me decide to make this repertoire series? I had such a pleasant experience working on my first Chessable course for Fischer Random Chess that it was easy to persuade me to do another one! I also decided to make the 1. e4 Repertoire series because I wanted to explore it a bit more. In this first course, we'll discuss all Black variations except for the Sicilian, French and Caro-Kann defences. These will be dealt with in the second course. My 1. e4 repertoire is specifically based on securing a space advantage or quick piece development early on. For example, against the Caro-Kann, Alekhine and 1... Nc6 openings, we typically advance our pawns to d4 and e5, grabbing space. I used Correspondence Database, Mega Database, and researched the latest games as a reference for this repertoire. For analyses, I mostly used the engine asmFish @@StartBracket@@which is a port of Stockfish@@EndBracket@@. Take Control As you can see from the size of the course, this is a tremendous amount of work but hopefully, the results will be as beneficial to you as they were to me. 1. e4 is the most popular first move for White and the reason is clear. With e4, we immediately take control of the very center of the board, and we fight for the initiative right at the beginning of the game. I tried to make the repertoire as cohesive as possible, to make it easier to learn. I want to stress that understanding is more important than memorization. It will be good to know the typical plans and ideas, where to put the pieces, how to improve your position and so on. Chess improvement is a continuous learning process, and there are no shortcuts. To get the most out of this repertoire series, the student should not rush, and instead, try to grasp the ideas behind the moves. Increase your understanding with 1. e4 openings. Study model games, study the classics! Play seriously, analyse your games and learn from your mistakes! Understand the essence and ideas behind your variations. Do not rely on memorization. Opening variations come and go, novelties and new computer engines are always updated, but your chess strength and understanding is permanent! It does not matter one bit if you can get an advantage out of the opening, but always fail to convert. Openings are just the first step towards getting good results and improving your rating. About Me I learned chess at the age of six. Back then I was relying on chess books for computer engines were not nearly as strong they are now. I became a Grand Master at the age of 14 which made me seventh youngest at the time. I achieved my highest rating of 2822 during the first half of 2017. It was good enough for #2 in the world back then. My greatest tournament victories were the Fischer Random World Championship and maybe my Olympiad performance in 2016... there have been several other events memorable for various reasons and not just because I won. Early Influences Let me confess that until I was about 15 years I exclusively played 1. e4. After all, it is 'Best by Test' according to Bobby Fischer! The first chess book I ever read was Chess Openings: Traps and Zaps by Bruce Pandolfini and it showed some aggressive openings starting with 1. e4 which very much impressed me. Some of my favourite early books were Attacking with 1. e4 (Emms) , I probably read this book 10 times over from cover to cover!, Beating the Sicilian (Nunn and Gallagher) and The Chess Advantage in Black and White (Kaufman) 2004 (!) version. These books helped tremendously in shaping my style, back in the days when computers were not helpful for preparation. I also read Opening for White according to Anand (all 14 of them!) which was written by GM Alexander Khalifman. That was the basis of my repertoire when I was a teenager. It was the best opening series out there at the time. It's a bit outdated now, but still a great book. Some of these made it to my repertoire as well, in some lines. For example, my recommendation against the Philidor, the Alekhine or the French 3. Nd2 have been recommended in some past opening books. But in general, I prefer to choose the variations myself without getting swayed by other manuals. Lead by Example I play 1. e4 in a majority of my games. Especially this year 2020, where most of the games are being held online. There are less tabiyas than on other first move openings, and I can guess better which openings are going to happen on the board. However, on a competitive level, it is important to switch between several openings, because computers are very strong nowadays! They can analyse all the way to a clear draw easily. And the surprise factor is a very important and underrated competitive tool. A well-prepared surprise can be psychologically unpleasant to face, as the opponent has to rely on his skills and not on memory which less and less players are prepared to do these days. I can definitely use my recommendations in my own games too! I am pretty confident about the stability and validity of the lines I chose in this 1. e4 repertoire series. Confident enough to play it against anybody. I have played it already in smaller online events, and practice games and I can say that I am very pleased with the results out of the opening. I hope I can lead by example, and make this repertoire work against the strongest players in the world, when I get the chance to compete against them. It's Your Turn I'm not necessarily saying that White gets an advantage in every single line, but in general, I can assure you that you'll most likely get positions that are easier to play, or ones in which hopefully you find yourself on some familiar ground. Over the years millions of games have been played, but even now there are still improvements to be found for both sides. This is my first repertoire recommendation and I'll be happy if it stands the test of time. Over my career, I have played many games with 1. e4 and I hope you will have as much fun playing it as I have! Wesley So, Minnetonka, Minnesota August 2020 } 1... d6 { This is the starting move of the Pirc Defence. We open the c8-h3 diagonal for our light-squared Bishop, but this is not the primary purpose of that move. By playing  1...d6  , we stop White from pushing e4-e5 for the time being. We plan to develop our Kingside by fianchettoing the dark-squared Bishop with ...g6 and ...Bg7. The Knight usually jumps to f6 and we are ready to castle Kingside quickly.  Our move  1...d6  does not stop White from playing  2.d4  and usually White accepts this invitation to build the perfect central pawn duo. It is by far the mainline, and it makes a lot of sense, of course.  However, White might avoid all the main lines that arise after  2.d4  and choose one of many second move alternatives. We will take a look at those alternatives in this chapter.  None of White's alternatives are theoretically challenging, but our opponents might play a pet setup that they also employ against other openings, particularly the Sicilian. Against the Sicilian the Grand Prix Attack @@StartFEN@@rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1@@EndFEN@@  1.e4  c5  2.Nc3  Nc6  3.f4  combined with Bc4 or Bb5 later or the Closed Variation @@StartFEN@@rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1@@EndFEN@@  1.e4  c5  2.Nc3  Nc6  3.g3  or @@StartFEN@@rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1@@EndFEN@@  1.e4  c5  2.d3  Nc6  3.g3  are popular at the club level.  Most of White's offbeat lines against the Pirc follow a similar approach. White plays a combination of Bc4 and f4 - Grand Prix style - or plays with g3 like in the Closed Variation of the Sicilian. In almost all cases, we will suggest completing the kingside development and playing ...c5 quickly to transpose into a harmless variation of the Sicilian.  One notable exception is the Grand Prix setup of f4/Nc3/Bc4 which we recommend to fight differently. Let's have a look at the 'Odds and Ends' of the Pirc now. } { This is the starting move of the Pirc Defence. We open the c8-h3 diagonal for our light-squared Bishop, but this is not the primary purpose of that move.   By playing  1...d6  we stop White from pushing e4-e5 for the time being. We plan to develop our Kingside by fianchettoing the dark-squared Bishop with ...g6 and ...Bg7. The Knight usually jumps to f6, and we are ready to castle Kingside quickly. } (1... g6 2. d4 c6 (2... Bg7 3. Nc3 { The move } 3... d5 { is actually very solid, and I believe this has been recommended in a few books as a solid surprise weapon. Black sacrifices the pawn on d5, with the idea in return to develop quickly and regain it back with ...Nf6 followed by ...Nbd7-b6. } (3... c5 { This move has a very dubious reputation but still, we have to know how to react to such a rarely seen line. } { This move has a very dubious reputation. But still we have to know how to react to such a rarely seen line. } 4. dxc5 Qa5 (4... Na6 5. Bxa6 bxa6 6. Nge2 { followed by Be3, leaves White a clean pawn up. }) (4... Bxc3+ { Black damages our pawn structure and he hopes to gain enough compensation to giving up his powerful Bishop. This is his main idea. He hopes to unbalance the game a little bit. } 5. bxc3 { Possible is } 5... Qa5 { is met by the accurate } (5... Nc6 6. Bd3 Qa5 7. Ne2 Qxc5 8. O-O Nf6 9. Rb1 { but I think Black is not going to have a lot of fun in this position. White has the Bishop pair, and he can exploit the weakened dark-squares in the enemy position. } 9... O-O (9... Qa5 10. Bh6 { Black's position is very difficult. Marks,D -Bowen,F 2018. White's doubled pawns do not play a serious role in the position, meanwhile he controls a lot of important squares. }) 10. Rb5 Qd6 11. c4 Qc7 12. Nc3 d6 13. f4 b6 14. Rg5 Ba6 15. Qe1 { this led to a powerful attack for White in Weil, T -Bowen,F 2018. He is preparing active operations with either e4-e5 or Nc3-d5 etc. }) (5... Nf6 { This move is very provocative, but it's all part of Black's plan. After all he is seeking to unbalance the game with his opening. } 6. e5 Ne4 7. Bc4 { White does not protect his pawns, but instead goes for a counterattack ! Black's Kingside, especially the f7-pawn remains in serious danger to attack. } 7... Qa5 (7... Nxc5 8. Nf3 Nc6 9. O-O { In case of } 9... b6 (9... Ne6 10. Re1 b6 11. Bd5 h6 12. Ba3 Bb7 13. c4 Rc8 14. Qd3 { White is better, even though the position remains complex in Kornyushin,N -Mondry,M ICCF email 2018. His threats include Rad1 or Nh4, attacking the vulnerable Kingside. }) 10. Bh6 Ba6 11. Bxa6 Nxa6 12. Ng5 { Black's Kingside is in serious danger. Even after his best defence } 12... Qc8 13. Re1 Nd8 14. Qd4 Rg8 15. a4 { he remains under pressure as his King is stuck in the center. }) 8. Ne2 Nxc5 { And now after the important move } 9. Qd5 e6 10. Qf3 Nc6 11. O-O { this is clearly better for White. The dark-squares on Black's camp are just way too vulnerable. }) 6. Qd4 Nf6 7. Qb4 { protecting his pawns and offering to lead the game to a better endgame. After } { protecting his pawns and offering to lead the game to a better endgame. } 7... Nc6 (7... Qc7 { Black has to keep the Queens on the board in order to keep matters complicated. } 8. Nf3 O-O (8... Nc6 9. Qa4 { gives White some pressure. } 9... Ne5 10. Qd4 Nc6 (10... Nxf3+ 11. gxf3 O-O 12. Be3 b6 13. Bd3 Bb7 14. a4 { White is still a pawn up, and he has the Bishop pair. Black is struggling to equalize the game. }) 11. Qe3 { gives White some pressure. }) 9. e5 { Perhaps White has other good moves here as well, but this is simple enough. It was also fine to just play 9.Bd3 with some advantage. } 9... Nc6 10. Qf4 Nh5 11. Qe3 b6 12. Bb5 Bb7 13. O-O Ng7 14. Re1 { White has the Bishop pair, and the pawn on e5 controls a lot of squares. He is better. }) 8. Qxa5 Nxa5 9. Bd3 O-O 10. Bg5 { White has a clearly better ending. }) 5. Bd2 Qxc5 6. Nd5 { Black has some problems with the uncomfortable position of his Queen. } 6... Na6 { This is the only way to stop the threat of Bb4. } 7. Nf3 Nf6 (7... e6 { Black has to kick the enemy Knight away from d5, he cannot tolerate it there for long. } 8. b4 Qd6 (8... Qf8 9. Nc3 { This is White's best move. He can't afford to sacrifice a piece yet, and there is no need for that. After the old line 9.Bxa6 exd5 10.exd5 bxa6 11.O-O Qd6 ! 12.Re1+ Kf8 13.c4 ∞ White's compensation for the piece is only good enough for approximate equality. } { After } 9... Nxb4 (9... Qxb4 10. e5 { the weak square on d6 proves to bring Black peril. }) (9... Nc7 { Trying to consolidate his pieces. Black's dark-squares on d6 and c7 are too vulnerable for him to consider grabbing the pawn on b4. } 10. Rb1 Qe7 11. e5 f6 { fails after } (11... d5 12. exd6 Qxd6 13. Ne4 Qc6 14. Bd3 f5 15. b5 Qd5 16. Nc3 Qd8 17. O-O Nh6 18. Bc4 Nf7 19. Qe2 O-O 20. Rfd1 Bd7 21. a4 { White kept strong pressure on Black's position in the game Gonzalez Sanchez,F -Heini,H ICCF email 2018. 21.h4 with the idea to play Nf3-g5 also makes perfect sense. }) 12. Ne4 fxe5 13. Bg5 Nf6 14. Nd6+ Kf8 15. Nxe5 { White's position is crushing. }) 10. Nb5 Qc5 11. c3 Na6 12. Be3 Qc6 13. Nfd4 Qc5 14. f4 Qe7 15. e5 { White's lead in development in combination with the weak dark-squares around Black's King give him a winning advantage. }) 9. Bf4 Qf8 10. Bxa6 exd5 11. O-O { leads to a very powerful initiative for White. }) 8. b4 Qd6 9. Bf4 Qe6 10. Ng5 Qc6 11. Be5 { Thanks to the threat of b4-b5, White is winning material. Black can still try to complicate things with } 11... h6 12. b5 Qc5 13. Bd4 Nxd5 14. Bxc5 { 14.Bxg7 is enough for a large advantage also. } 14... Bc3+ 15. Ke2 Nf4+ 16. Ke3 Nxc5 17. Nxf7 Kxf7 18. Kxf4 { Black does not have enough compensation for the Queen. The King can hide to safety by Ke3-e2 if necessary. }) (3... a6 { is an interesting flexible move, and Black can play this in the modern. The idea behind it is to put pressure on e4 right away by playing ...b7-b5 and then ...Bb7. Meanwhile Black has options to play ...d5 in one move. I recommend } 4. Be3 { against it, playing in the same spirit of our system. Or 4.h4 !? which is an interesting reply against ...a6. White threatens h4-h5, and it basically forces Black to reply with h5 in return the square g6 becomes slightly vulnerable and White gets the outpost g5 for his Knight. 5.Be3 b5 6.Bd3 Bb7 7.Nf3 += I like White's position here. He has an outpost on g5, and he has the healthy idea of improving his position by playing Ne2-g3 etc. } 4... b5 5. Qd2 Bb7 6. f3 { Now playing 6... d6 will transpose us back to the usual lines. Black may try } 6... d5 { when White has a choice. } 7. exd5 { 7.e5 c5 8.f4 is also worthy of attention, as for the moment the Bishop on b7 is very passive. } 7... Nf6 8. Bd3 Nxd5 9. Nxd5 Bxd5 10. Ne2 Nc6 11. Nf4 O-O 12. c3 Re8 13. O-O { White has a tiny edge in the position. He can take on d5 next and claim the Bishop pair advantage. }) (3... e6 { looks utterly ridiculous, because Black is trying to play as in the French Defence, but the Bishop is misplaced on g7. Just to show you quickly } 4. h4 { is a good response from White, controlling the g5-square (with the idea Bg5) or to play h5-h6, hitting the Bishop on g7. After } 4... h5 (4... d5 5. e5 { White has a very favourable version of the French. }) 5. Bg5 Ne7 6. Nf3 d6 7. Qd2 { gives White very easy play. }) (3... c6 4. Be3 { 4.f4 is a good alternative here as well. However, you'd need to know some lines from the Austrian Attack, and I'm not recommending that in this repertoire. } 4... Qb6 { attacks the b2 and d4-pawns, White can defend that with } (4... d5 5. e5 { Even in this position with the Bishop on e3, advancing the pawn on e5 works quite well. } 5... f6 (5... c5 6. f4 cxd4 7. Qxd4 e6 8. Qd2 Ne7 9. Nf3 Nbc6 10. O-O-O { White has an excellent version of the French, and Black does not solve his opening problems. } 10... f6 11. exf6 Bxf6 12. Kb1 O-O 13. h4 { there are too many weak squares on Black's camp. }) (5... Nh6 6. Qd2 { Or } 6... Ng4 (6... Nf5 7. Bf4 h5 { Securing the square f5 for his Knight. } 8. O-O-O { White's King is quite safe on the Queenside too, and the d4 pawn gets extra protection from the Rook on d1. } 8... Nd7 9. Nf3 Nf8 10. Bd3 Ne6 11. Bxf5 gxf5 (11... Nxf4 12. Bxc8 Bh6 13. Bxb7 Ne6 { This is Black's idea all along, as now he wins the Queen thanks to the pin. } 14. Qxh6 Rxh6 15. Bxc6+ Kf8 16. Bxd5 { But White gets too much material in return for the Queen. } 16... Rc8 17. Bxe6 fxe6 18. Ng5 Rc6 19. Kb1 Rh8 20. Nce4 { White has too many pieces in return for the Queen. Nc5 is coming next, Black has absolutely no counterplay and what's left of his pawns are shattered. }) 12. Ne2 Nxf4 13. Nxf4 Bh6 14. Kb1 { White has a solid stake on f4 and pressure on the Kingside, meanwhile Black's light-squared Bishop is very passive. }) 7. Bf4 f6 8. exf6 Nxf6 9. Nf3 O-O 10. h3 { when White maintains some pressure, for example after } 10... Bf5 11. O-O-O Nbd7 12. Bh6 b5 13. Bxg7 Kxg7 14. Bd3 Bxd3 15. cxd3 { he controls the important central squares and maintains control over the position. }) 6. f4 Qb6 7. Na4 Qa5+ 8. c3 Nh6 9. Nf3 Nd7 10. b4 Qc7 11. Be2 O-O 12. O-O { White has a small but stable advantage, thanks to his extra space advantage. }) 5. a3 Qxb2 { is no longer possible. After } (5... d6 6. Nf3 Nf6 7. Be2 O-O { White has a slight advantage, as the Queen on b6 is not doing much. } 8. O-O Nbd7 9. Nd2 Qc7 10. f4 e5 11. dxe5 dxe5 12. f5 { White starts a powerful attack on the Kingside with g2-g4 or Qe1-h4 coming next move. }) 6. Na4 { the black Queen is trapped. }) (3... d6 4. Be3 { I am recommending the same variation as against the Pirc Defence. White plays the so called '150' attack, a variation that is quite easy to learn and to play. He aims to play Qd2 next, and then decide whether to go for the setup with Nf3 and Bd3, or to play f2-f3 followed by Queenside castling. } 4... Nc6 { can be met by } (4... Nd7 5. Qd2 a6 { transposes to the move-order 4... a6. } (5... e5 6. Nf3 Ngf6 7. dxe5 Nxe5 8. Nxe5 dxe5 9. Qxd8+ Kxd8 10. O-O-O+ Bd7 11. Bc4 { and White has a pleasant endgame advantage as the enemy King is quite vulnerable and there is some pressure along the d-file. })) (4... c6 5. Qd2 b5 6. Bd3 { If Black puts his Knight to f6 } 6... Nf6 { then after } (6... Nd7 { This is a very flexible way of developing. Black activates the Queenside pieces first, meanwhile he delays moving the Knight on g8 in order to prevent any Be3-h6 ideas } 7. Nf3 Bb7 { 7...Ngf6 8.Bh6 is analysed in the Pirc,variation 5... c6, found on the move-order 1. e4 d6 2. d4 Nf6 3. Nc3 g6 4. Be3. } (7... a6 8. a4 Rb8 9. axb5 axb5 10. O-O b4 11. Na2 c5 12. e5 { White opens up the center, and this led to a quick win for White in Gromotka,H -Scaramuzzo,G ICCF email 2018. }) (7... Nb6 8. O-O { White may also play 8.h3 first, just to prevent ...Bg4. } 8... Bg4 9. Ne1 { With the King already on the Kingside, White wouldn't want to allow doubled f-pawns, so he removes the Knight first, plays h2-h3 and then develops the Knight back to f3. } 9... Nf6 10. h3 Bc8 11. Nf3 O-O 12. Bh6 { White has his typical solid and stable advantage. In the game they played: } 12... Qc7 13. e5 dxe5 14. dxe5 Nfd5 15. Nxd5 Nxd5 16. Rae1 { when White's threat of Re4-h4 and attack on the Kingside is quite threatening. Staak,E -Slupski,M 2015. }) (7... Qc7 { Black still delays developing his Knight to f6, and meanwhile he keeps an eye on the e5-square. } 8. Ne2 { White has many other possibilities here, 8. a4, or first 8. O-O is also playable. However, I recommend this move, improving the position of the Knight while threatening to break up Black's Queenside with a2-a4. After } { White has many other possibilities here, 8. a4, or first 8. O-O is also playable. However, I recommend this move, improving the position of the Knight while threatening to break up Black's Queenside with a2-a4. } 8... Ngf6 (8... Bb7 9. a4 a6 10. Ng3 c5 (10... e5 11. dxe5 dxe5 12. axb5 axb5 13. O-O Rxa1 14. Rxa1 Ngf6 { We are following the game Gross Winter,G -Dziedzic,A 2017, White has some pressure on the a-file and now he puts Black's Queenside under check: } 15. Qc3 { Threatening Bxb5. } 15... Qb8 (15... Ng4 16. Ba7 { White is still threatening Bxb5, and meanwhile he obviously does not want to give up his powerful dark-squared Bishop. } 16... Qd6 17. h3 Ngf6 18. Be3 O-O 19. Ra7 Qb8 20. Qa5 Rc8 21. c4 { the pressure on the Queenside is very annoying, meanwhile both of Black's Bishops are in a passive state. }) 16. Qa3 Bf8 17. b4 Be7 18. Qb3 { with the idea c2-c4 is clearly in White's favour too. }) 11. c3 Ngf6 12. Bh6 { He does not solve all his problems either after } 12... Bxh6 (12... O-O 13. Bxg7 Kxg7 14. h4 h5 15. d5 { and White remains with a solid and stable advantage. The Bishop on b7 remains out of the game for the moment. }) 13. Qxh6 cxd4 14. cxd4 Qa5+ 15. Ke2 bxa4 16. Rhd1 { Black has some problems with his King stuck in the center, meanwhile the white pawn center remains well supported. }) 9. Bh6 O-O 10. Bxg7 Kxg7 11. h4 h5 12. Ng3 { White maintains some pressure. He has strong center pawns, meanwhile the enemy black King could easily become vulnerable. } 12... e5 13. a4 Bb7 14. O-O a6 15. Qg5 { Black's Kingside is quite shaky, and the natural reply } 15... Nh7 { loses due to } 16. Nxh5+ Kg8 17. Qh6 gxh5 18. Ng5 Nxg5 19. hxg5 Rfe8 20. f4 Re6 21. Qxh5 Rg6 22. Rf3 { White's threats of Rh3 and Raf1 are very difficult to meet. }) 8. O-O a6 (8... Qc7 9. Rfe1 { White is preparing to play e4-e5 at the opportune moment, and his Rook gets ready for any quick opening in the center. } 9... e5 { loses because of } (9... Ngf6 { can be met by the simple 10. Bh6, weakening Black's dark-squares or even } 10. e5 { White lures the black Queen to e5. } 10... dxe5 11. dxe5 Nxe5 12. Nxe5 Qxe5 13. Bh6 Bxh6 { Black's Queen is attacked, so he must allow the White Queen's raid. } 14. Qxh6 Qc7 15. Qg7 { This was the idea behind 10. e5: Black is forced to castle Queenside. } { Instead } 15... Rf8 { drops the Knight after } (15... O-O-O 16. Qxf7 Rhe8 17. h3 Kb8 18. a4 b4 19. Ne4 { Black has no compensation for his isolated e-pawn and on top of that, the Queen on f7 is super annoying. }) 16. Qxf6) (9... a6 { Now White has a good choice between } 10. b4 { preparing a2-a4, and controlling the dark-squares on the Queenside. Or 10.Rad1 centralizing the pieces very well. After c5 11.Bf1 cxd4 12.Bxd4 Ngf6 13.Nd5 White has a simple and stable advantage. } 10... Ngf6 11. Bh6 Bxh6 12. Qxh6 e5 13. h3 { White has a solid and stable advantage that is so typical of the Modern Defence with 4. Be3. Now, even after Black's best defence } 13... Qd8 14. a4 Ng8 15. Qd2 { The point of ...Qd8 is that after 15.Qg7 Qf6 the Rook on h8 is defended. } 15... Ngf6 16. axb5 axb5 17. d5 cxd5 18. exd5 O-O 19. Bxb5 Qb6 20. Bf1 { it's not clear if Black has enough compensation for his pawn. }) 10. dxe5 dxe5 11. Bxb5 cxb5 12. Nxb5 Qc6 13. Nd6+ Kf8 14. Rad1 { White has too many threats, and the opponent cannot defend against them all. } 14... Ba6 15. Qb4 Ne7 16. Qb3 { and White wins tons of material, thanks to the threat of checkmate on f7. }) 9. a4 b4 10. Ne2 c5 11. dxc5 { The simple 11.c3 followed by Ng3 was possible, but the text is even stronger. After } 11... dxc5 (11... Nxc5 12. Qxb4 Qc7 13. Nd2 Nf6 14. f3 { Now the pawn on e4 is solidly protected, and Black does not have enough for his pawn after } 14... O-O 15. Qa3 Ne6 16. Nd4 { White is simply a pawn up. Additionally, he can immediately activate his Queenside pawn majority by b2-b4 and c2-c4. Another way to gain space on the Queenside is by playing a4-a5, thereby controlling the b6-square. 16...Nc5 can be met by 17.b4 Nxd3 18.cxd3 , stabilising the center while dominating the Queenside. }) 12. Rfd1 Qc7 13. c3 bxc3 14. Nxc3 Ngf6 15. Bf4 Qc8 16. Bc4 Nb6 17. Ba2 { White keeps some pressure on the position. He has pressure on the diagonals, and the c5-pawn could become quite vulnerable. }) 7. Nf3 { we transpose to the Pirc Defence, analysed under the move-order 1. e4 d6. } { White protects his e4-pawn, while also developing the rest of his Kingside pieces. }) (4... Nf6 { transposes to the Pirc Defence. } { Black can also develop his Queenside first before playing ...Bg7, but it's not clear that approach is advantageous for him. }) (4... a6 { This is Black's main variation in the Modern Defence. He is aiming for Queenside expansion with ...b7-b5, meanwhile he keeps the diagonal h1-a8 open for his light-squared Bishop. And he is aiming to be able to play a quick ...c5 in one move. His play is easy to implement: play b5, then Bb7, Nd7 and then ...c7-c5 etc. The move } { This is Black's main variation in the Modern Defence. He is aiming for Queenside expansion with ...b7-b5, meanwhile he keeps the diagonal h1-a8 open for his light-squared Bishop. And he is aiming to be able to play a quick ...c5 in one move. His play is easy to implement: play b5, then Bb7, Nd7 and then ...c7-c5 etc. } 5. f4 { is a good one, seizing the center. And this is recommended in Larry Kaufman's latest 2019 repertoire book. It is most likely leading to positions that are in White's favour, but he does have to know a good deal of details in the arising variations. The point of ...a6 is that after 5.a4 he can reply with 5...Nc6!? when he is able to use the square b4 favourably in some cases, for example after 6.d5 Nb4∞ } (5. Qd2 { I decided to stick to our usual recipe of meeting the Pirc/ Modern. I am recommending the Be3 Qd2 setup no matter what Black plays. } { I decided to stick to our usual recipe of meeting the Pirc/ Modern. I am recommending the Be3+Qd2 setup no matter what Black plays. } 5... b5 6. O-O-O { Against 6.Bd3 in this case, unfortunately, Black is alright after 6...Nd7 7.Nf3 Bb7 8.O-O c5 He managed to play ...c7-c5 in one move, and this makes all the difference in Black's fight for equality. 9.Rfe1 Rc8 Or 9...cxd4 followed by ...Ngf6. In both cases Black is equalizing. } 6... Bb7 7. f3 { Solidly protecting the e4-pawn. This way of playing is quite different from what I am usually recommending (usually we play Bd3+Nf3 etc) , but in this case, it is a solid and stable approach to meet Black's setup. After } { Solidly protecting the e4-pawn. This way of playing is quite different from what I am usually recommending (usually we play Bd3 Nf3 etc) , but in this case it is a solid and stable approach to meet Black's setup. } { Solidly protecting the e4-pawn. This way of playing is quite different from what I am usually recommending (usually we play Bd3+Nf3 etc) , but in this case it is a solid and stable approach to meet Black's setup. } 7... Nf6 { White can reply with } (7... Nd7 8. h4 h6 { is possible, intending to meet h4-h5 with ...g5. } (8... Ngf6 9. g4 h6 (9... h5 10. g5 Nh7 { this looks quite dubious for Black. His Knight on h7 is passive, and he has little space to manoeuvre his pieces. } 11. Nge2 c5 12. dxc5 Nxc5 13. Bd4 O-O 14. Bxg7 Kxg7 15. Qd4+ Kg8 16. Bh3 { Black's position looks very uncomfortable. }) 10. Nh3 { transposes to 8... h6. }) (8... h5 { Black prevents the opening of the h-file, but in return he gives up the g5-square for the Knight. } 9. Nh3 { The Knight will put strong pressure on the f7 and e6-squares from its outpost on g5. After } { The Knight will put strong pressure on the f7 and e6-squares from its outpost on g5. } 9... Rc8 (9... e6 10. Ng5 Ngf6 { transposes to 9... Ngf6. } { Black is aiming to play ...Qe7 next move, keeping an eye on the vulnerable f7-and e6-squares. } 11. Kb1 Qe7 12. Rg1 { White can also start first with the prophylactic 12. a3, controlling the b4-square. But with this move he wants to start active operations in the near future, preparing g2-g4. After } { White can also start first with the prophylactic 12. a3, controlling the b4-square. But with this move he wants to start active operations in the near future, preparing g2-g4. } { White can also start with the prophylactic 12. a3, controlling the b4-square. But with this move he wants to start active operations in the near future, preparing g2-g4. } 12... O-O { is too provocative. White gladly plays } (12... c5 { we just take } 13. dxc5 dxc5 14. Bf4 { threatening Bd6. } 14... e5 15. Be3 { Now the square d5 is weak and the long diagonal for his g7-Bishop is closed down. } 15... O-O 16. g4 { White is clearly better here. }) (12... Nb6 13. Bd3 { Preventing Black's threat of ...b5-b4 followed by ...Nc4, snatching off White's important dark-squared Bishop. Another way to play is 13.a3 Nfd7 14.Qf2 with a solid positional game where White's chances are slightly better. } 13... Nfd7 14. g4 { It's hard to see how else White can make progress in the position, and it looks like the time has come to open up the g-file. After } { It's hard to see how else White can make progress in the position, and it looks like the time has come to open up the g-file. } 14... O-O-O (14... hxg4 15. fxg4 Rxh4 { is too risky as after } (15... O-O-O { Black has to bring his King towards safety. } 16. Rdf1 Rdf8 17. Nf3 { and we reach this position where White has a small advantage, but Black's game is fully playable. White's pawns on the fourth rank control a lot of squares, and he has ideas of advancing on the Kingside with h4-h5. The game could continue: } { and we reach this position where White has a small advantage, but Black's game is fully playable. White's pawns on the fourth rank control a lot of squares, and he has ideas of advancing on the Kingside with h4-h5. The game could continue: After } 17... f5 (17... Kb8 18. h5 gxh5 19. gxh5 f5 20. h6 Bf6 21. exf5 exf5 22. a3 Re8 23. Bf4 { and White has definite pressure. The pawn on f5 is vulnerable, while his outside passed pawn on h6 could get out of control. }) 18. gxf5 gxf5 19. exf5 exf5 20. Bg5 Qf7 21. Ne2 { the pawn on f5 could become vulnerable later on. }) 16. Rdf1 f6 17. d5 fxg5 (17... exd5 18. Nxd5 Nxd5 19. exd5 O-O-O 20. Ne6 { The Knight on e6 is way too powerful. }) 18. Bxg5 { wins the material back, plus interest. }) 15. gxh5 Rxh5 16. Bf2 Kb8 17. f4 { White follows up with e4-e5, when he has a small advantage thanks to his extra space. }) 13. g4 b4 14. Ne2 hxg4 15. Ng3 { with an attack. } 15... c5 16. h5 cxd4 17. Bxd4 Nxh5 18. Nxh5 gxh5 19. fxg4 h4 20. Nf3 Ne5 21. Bxe5 dxe5 22. Bd3 { and he is much better. The black King is very vulnerable on the Kingside after the follow up plan of Qh2 or Rh1. }) (9... Ngf6 10. Ng5 O-O { Castling right away leads to a powerful Kingside attack after } (10... e6 { transposes to 9... Ngf6. } { Black is aiming to play ...Qe7 next move, keeping an eye on the vulnerable f7-and e6-squares. }) 11. g4 hxg4 (11... c5 12. dxc5 Nxc5 13. gxh5 { 13.e5 b4 ! allows Black to survive, as he creates a counterattack on our Knight. } 13... Nxh5 14. Kb1 { Nevertheless even here White has a stable advantage. He wants to follow up eventually with Bh3-g4, removing Black's Knight from his blockading outpost on h5. } 14... b4 (14... Qc7 15. Bh3 b4 16. Ne2 a5 17. Bg4 Nf6 18. Bd4 { The move 18.Rdg1 with the threat of h4-h5, is also good enough. } 18... Nxg4 19. Bxg7 Kxg7 20. h5 { And White starts decisive operations on the enemy King. After } 20... Rh8 21. hxg6 fxg6 22. Nd4 Qc8 23. fxg4 Rxh1 24. Rxh1 Qxg4 25. Qh2 { the black King has no good way to defend himself. }) 15. Ne2 Qc7 16. Bd4 Bxd4 17. Nxd4 { White has a stable advantage. His pieces are well-placed, and Black's counterplay is not threatening. }) 12. h5 gxh5 13. fxg4 Nxg4 14. Be2 Nxe3 15. Qxe3 { this looks suicidal for Black, with the open g and h-files. }) 10. Ng5 c5 11. e5 { White starts a very powerful initiative. The tactics work out well in his favour here. } 11... cxd4 12. e6 dxc3 (12... fxe6 13. Bxd4 e5 14. Bd3 Nf8 15. Bf2 { White's compensation for the pawn is sufficient. Black has problems with his development as the Knight on f8 is required to protect the g6-square permanently. } 15... Qa5 (15... d5 16. Rhe1 Qd6 17. Kb1 Nf6 18. a4 b4 (18... bxa4 19. Nxa4 N6d7 20. Qa5 Bf6 21. c4 d4 22. f4 { White has a powerful initiative. The black King is stuck in the center for a while. }) 19. Na2 { is bad for Black, as after } 19... a5 20. Bg3 N6d7 21. Bb5 { his pawns on e5 and d5 are quite vulnerable. }) 16. Kb1 Nf6 17. Rhe1 { Black may try } 17... Rxc3 (17... b4 18. Ne2 Bh6 19. a3 Bxg5 20. hxg5 Nd5 21. Be4 e6 22. Rh1 Rh7 23. Be1 { we are following the game Armien,B -Ackley,P ICCF email 2017. White wins the pawn on b4, and he has the better position. Thanks in part to his two powerful Bishops. }) 18. Qxc3 Qxc3 19. bxc3 Nd5 { but his compensation for the exchange is not totally enough after } 20. Ne4 Nf4 21. Bf1 Nd7 22. c4 bxc4 23. g3 Ne6 24. Bxc4 { White managed to repair his pawn structure. Black can't compensate for his material deficit. }) 13. exf7+ Kf8 14. Ne6+ Kxf7 15. Nxd8+ { wins the black Queen with a very important check ! } { wins the black Queen with a very important check! }) 9. Nh3 { White develops the Knight this way, but he can also start with 9.g4 } 9... Ngf6 10. g4 { transposes to 8... h6. } 10... Nb6 11. d5 { White occupies extra space and threatens to play Bd4 next move, pinning the enemy Knight on f6. There had been a few games played from this position, and we'll take a look at them. } { White occupies extra space and threatens to play Bd4 next move, pinning the enemy Knight on f6. There had been a few games played from this position, and we'll take a look at them in the main course, starting from variation 7... Nd7 8. h4 h6 #1. } 11... h5 (11... Nfd7 12. Bd4 Ne5 { is just met by the simple } 13. Be2 b4 14. Nb1 { when the threat of f3-f4 is very powerful next move. }) (11... c5 12. dxc6 Bxc6 13. Bd4 { gives unpleasant pressure along the a1-h8 diagonal. }) (11... b4 12. Nb1 { Keeping the c4-square under control, White prevents any counterplay (like ...Nc4 ideas) for the moment. } 12... a5 13. Bb5+ Nfd7 (13... Kf8 14. g5 hxg5 15. hxg5 Nh5 { We are following the game Plas,R -Mehlhorn, U 2018. They continued with } 16. Bd4 Rc8 17. Nf4 Nxf4 18. Rxh8+ Bxh8 19. Bxh8 Nh5 20. Bd4 c6 21. dxc6 Bxc6 22. Ba6 Ra8 23. Bf1 Nd7 24. Bh3 { and White has a positionally crushing position thanks to his Bishop pair and far safer King. }) 14. Bd4 Bxd4 15. Qxd4 Rg8 16. h5 { is also better for White. }) 12. gxh5 Nxh5 13. Bd4 c5 14. dxc6 Bxc6 15. Bxg7 Nxg7 16. Nf4 { White has some initiative, and he is planning to attack the Kingside next with h4-h5. }) 8. Bh6 { The move 8.g4 !? with the idea to open files on the Kingside, is a more double-edged way of playing. } 8... Bxh6 9. Qxh6 { when White's Queen is quite annoying on h6, and he has extra space. } 9... Nbd7 10. Kb1 { The move 10.e5 would have been powerful if not for the reply 10...b4 ! counterattacking White's Knight on c3. After 11.Nb1 Nd5 12.e6 N7f6 ∞ the Knight on d5 is very powerfully placed, and this compensates for some of his Kingside weaknesses. } 10... b4 (10... e5 11. Nge2 { White may play 11.dxe5 dxe5 12.Nh3 !? Qe7 13.Nf2 O-O-O 14.a4 c6 ∞ but here Black is very solid. Egorov,V -Torell,H LSS email 2013. He has solid control of the Queenside dark-squares and is ready to trade Rooks along the d-file. } 11... Qe7 12. a3 { Controlling the b4-square, and waiting to see what Black does next. } 12... O-O-O { is comfortably met by } (12... c5 13. dxe5 { White may also reply 13.d5 Qf8 14.Qe3 h5 15.Nc1 Qh6 16.Qf2 !? O-O 17.Nb3 when Black is very solid, but White has the extra space. } 13... dxe5 14. Nc1 { The Knight is threatening to go to a5 with Nb3-a5. } 14... c4 15. g3 Qf8 16. Qd2 Qe7 17. Bh3 Nc5 18. Qh6 Qf8 19. Qe3 Qe7 20. Rd2 O-O 21. Rhd1 { and White has some pressure thanks to his control of the d-file and the h3-c8 diagonal. }) (12... Qf8 13. Qe3 Qe7 { does not help Black, as he just lost two tempi, and after } 14. g4 { White has extra space, meanwhile Black's counterplay has not even begun yet. }) (12... exd4 13. Nxd4 O-O-O { Black is planning to break in the center with ...d6-d5, and White needs to hurry with his development. } 14. g3 { White intends to activate his Bishop on the h3-c8 diagonal and to try to put pressure that way. } { White intends to activate his Bishop on the h3-c8 diagonal and to try to put pressure that way. After } 14... Kb8 (14... d5 15. exd5 Nxd5 16. Nxd5 Bxd5 17. Bh3 Kb8 { And now White has the concrete move } 18. Nxb5 { posing some problems to Black: } 18... Bxf3 19. Rhe1 Ne5 20. Rxd8+ Rxd8 21. Nc3 f6 22. Qf4 Bb7 23. Bf1 { and White has a small edge, thanks to the fact that his King is safer than Black's. }) 15. Bg2 Nb6 16. Rhe1 Rhe8 17. Nb3 { White maintains a small but stable edge: } 17... Nc4 18. Qc1 { If Black does not do anything, then White has Bf1 next move, kicking away the enemy Knight. } 18... d5 19. e5 Nh5 20. f4 c6 21. Nd2 Nb6 22. b4 Ng7 23. Nb3 Ne6 24. Bh3 Bc8 25. Ne2 { and White has some edge, thanks to his control of the Queenside dark-squares. }) 13. d5 { gaining some space near the Black King's position. } 13... Nb6 { is met by } (13... c6 14. dxc6 Bxc6 15. Nc1 Nb6 16. Qe3 Qc7 17. a4 Nxa4 18. Nxa4 bxa4 19. Bxa6+ Kd7 20. Nd3 Ke7 21. Nb4 { White is better thanks to his well-placed Knight on b4, and Black's King on e7 is not very safe. }) 14. Qe3 { preventing Black's counterplay with ...c6, and preparing the manoeuvre Nc1-b3. }) 11. Nce2 { And obviously not 11.Na4 ? Bc6 ∓ } 11... e5 12. Nh3 Qe7 13. Nf2 a5 14. dxe5 dxe5 15. Nc1 a4 16. b3 { White has some edge. His King is safe, meanwhile Black's King cannot castle short for the moment. After } 16... axb3 17. cxb3 Qf8 18. Qd2 Qe7 19. Ncd3 c5 20. Nb2 O-O 21. Qd6 { White is clearly better. }) 5... b5 6. Nf3 Bb7 7. Bd3 Nd7 8. e5 c5 { Against both 8...Qc8 and 8...Nh6 White needs to have ideas on how to meet these moves as well. } 9. Be4 Bxe4 10. Nxe4 Nh6 11. dxc5 dxe5 { This move has been played by Magnus Carlsen a few years back, winning an impressive endgame against Wei Yi. The alternative 11...Ng4 12.Qe2 dxe5 13.O-O-O Qc7 14.fxe5 Ngxe5 15.Nc3 is probably better for White, but also looks very complicated. } 12. c6 Nf6 13. Nxf6+ exf6 14. Qxd8+ Rxd8 15. c7 Rc8 16. Bb6 Kd7 17. Ba5 Nf5 { Black is equalizing, and later he converted the endgame, Wei, Y -Carlsen,M Bilbao 2016. }) 5. Qd2 { After } 5... e5 (5... a6 6. Nf3 e5 (6... b5 7. a4 b4 8. Nd5 Rb8 9. c3 { White has a small but stable advantage thanks to his well-supported center pawns. }) 7. dxe5 Nxe5 8. Nxe5 Bxe5 9. O-O-O Be6 10. Be2 Ne7 11. f4 Bg7 12. g4 { is totally crushing for White in Cantelli,A -Bonatti,A ICCF email 2014. }) 6. Nge2 { is a good reply, protecting the d4-square while intending to meet Nf6 with f2-f3. 6.d5 Nce7 should also be better, but it's more complex, as Black has some counterplay after ...f7-f5. } 6... Nf6 { is met by } (6... exd4 7. Nxd4 Nf6 8. f3 O-O 9. O-O-O d5 (9... Nxd4 10. Bxd4 Be6 11. g4 c5 12. Be3 Qa5 13. Bh6 { Black's counterplay is not enough to compensate for the defects in his structure. For example } 13... Bxa2 14. Bxg7 Kxg7 15. Nxa2 Qxa2 16. Qc3 { White wins a piece, thanks to the threat of g4-g5 and Rxd6. }) 10. exd5 Nxd5 11. Bg5 { is very strong for White, and he remains up a pawn after } 11... Qd7 12. Nxc6 bxc6 13. Nxd5 cxd5 14. Qxd5 Qa4 15. Qb3 { Black's counterplay with ...Be6 followed by ...Rab8 is too slow, because he has to spend a tempo to avoid the trade of Queens: 15...Qc6 Or 15...Qa5 16.Bd2 Qe5 17.Bc4 Bf5 18.f4 ! Black runs out of active squares for his Queen. 18...Qd6 19.Be3 Qe7 20.Rhe1 Rab8 21.Bd4 ± 16.Bc4 The threat of Bd5 forces Black to simplify the position with ...Be6 17.Bxe6 fxe6 18.Rhe1 White found a new target in the e6-pawn Rab8 19.Qxe6+ Qxe6 20.Rxe6 Bxb2+ 21.Kd2 += }) 7. f3 { followed by Queenside castling. }) 4. exd5 { Taking on d5 makes sense, as otherwise the plan with a quick ...d5 becomes very justified. 4.e5 would allow Black to create quick counterplay with 4...f6 and probably later ...c7-c5 might come too, challenging White's center. } { Taking on d5 makes sense, as otherwise the plan with a quick ...d5 becomes very justified. } 4... Nf6 5. Bc4 O-O { is worse because after } (5... Nbd7 { Black should immediately try to regain the pawn on d5 by preparing ...Nb6. } 6. Nf3 { White gladly returns the pawn, while not making any concessions. In return, he castles quickly and develops all his pieces to their ideal squares. I'm not a big fan of playing 6.Bg5 Nb6 7.Bxf6 Bxf6 8.Bb3 White keeps his pawn, but in return, he has to give up the Bishop pair, and that is a serious concession. However, a good alternative for White here is the move 6.Qf3 !? protecting d5 for the moment. I like this line for White as well, however, you can only choose one move at a time and for now, I choose to recommend 6. Nf3. } { White gladly returns the pawn, while not making any concessions. In return, he castles quickly and develops all his pieces to their ideal squares. } 6... Nb6 (6... O-O 7. O-O Nb6 8. Bb3 Nbxd5 (8... a5 9. a4 { White prevents the opponent from gaining space, and secures control of the Queenside light-squares. } 9... Nbxd5 10. Nxd5 Nxd5 11. c3 { If } 11... b6 (11... Bg4 { Black hopes to ease up the pressure by exchanging some pieces off the board. } 12. h3 Bxf3 13. Qxf3 e6 14. g3 c6 15. h4 { White has a small but stable edge thanks to his Bishop pair. } 15... h5 (15... b5 16. Rd1 b4 17. Bg5 Qd6 18. Rac1 h6 19. Bd2 bxc3 (19... Rac8 20. c4 Nf6 21. Bf4 Qd7 22. Rc2 h5 23. Kg2 Ng4 24. Rcd2 Rfe8 25. Qe4 { Hebel,E -Wurtinger,R GER email 2016. Black later managed to hold on to the draw, but at this point I like White's position. }) 20. bxc3 Rfd8 21. Kg2 Rac8 22. h5 g5 23. c4 Nb4 24. d5 cxd5 25. cxd5 { Black's light-squares are quite vulnerable and White is better. }) 16. Re1 Re8 17. Bc4 Qf6 18. Qd1 { White has a small and long-lasting edge. Black's Kingside pawns are quite vulnerable and later White may consider attacking the Kingside with g3-g4. }) 12. Re1 e6 13. Bg5 { White keeps strong pressure on the board: } 13... Qd6 14. Bh4 Bb7 15. Ne5 c5 16. Bg3 { Followed by dxc5 leaves Black with an inferior pawn structure. }) 9. Nxd5 Nxd5 { transposes back to the move-order 6...O-O. }) 7. Bb3 Nbxd5 8. Nxd5 Nxd5 9. O-O O-O { transposes back to the move-order 6...O-O. } 10. Ne5 { leaves White a little better, for example: } 10... c6 (10... a5 11. c3 Qd6 12. Re1 Be6 13. Nd3 Bf5 14. a4 Rad8 15. Bg5 h6 16. Bh4 Rfe8 17. Nc5 { White has a large advantage and easy play. }) 11. Re1 Bf5 12. c3 Re8 13. Qf3 { Black has no counterplay here. }) 6. Nge2 { with the idea to play Nf4, it becomes much more difficult for him to regain the pawn. } 6... Nbd7 (6... a6 7. a4 c6 8. dxc6 Nxc6 9. O-O b6 10. Bg5 { White is simply a clean pawn up in my view. } 10... Bb7 11. Qd2 Rc8 12. Rfd1 Qd6 13. Ba2 Rfd8 14. h3 { White manages to consolidate his extra pawn by making logical moves. }) 7. Bb3 Nb6 8. Nf4 a5 9. a4 { Black can no longer regain d5 and he has to sacrifice a pawn now by playing ...c7-c6. }) 3. Nc3 d6 { can just be met by } (3... d5 { This variation is quite solid for Black, and it can also arise from a Caro-Kann 3. Nc3 move-order: @@StartFEN@@rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1@@EndFEN@@ 1.e4 c6 2.d4 d5 3.Nc3 g6 4.e5 In our repertoire, this position can be reached via transposition by, 1.e4 c6 2.d4 d5 3.e5 g6 4.Nc3 } 4. e5 { This is my suggestion on meeting this line. White closes the center and gains valuable space with his pawn wedge on e5. This seems to me at the moment White's best way to play. } { This is my suggestion on meeting this line. White closes the center and gains valuable space with his pawn wedge on e5. This seems to me at the moment White's best way to play. After 4.Nf3 Bg7 5.h3 Nf6 this move seems to be very hard to break. 6.e5 Ne4 7.Nxe4 dxe4 8.Ng5 c5 ∞ there have been many games played from this variation and the verdict seems to be alright for Black at the moment. } 4... h5 { can be met by } (4... f6 5. Bf4 Nd7 6. Qd2 fxe5 7. dxe5 Bg7 { transposes to 4... Bg7 after } 8. Nf3 { The e5-pawn is solid and well protected, and Black has some problems developing the g8-Knight. } 8... Nc5 9. h4 { Or 9.h3 Ne6 10.Be3 Qc7 11.O-O-O Bxe5 12.Nxe5 Qxe5 13.f4 } 9... Bg4 10. Nd4 Qc7 11. Qe3 Qb6 12. f3 { White has a strong lead in development while Black struggles to develop his Kingside. Additionally, the e5-pawn gives us a space advantage and blocks Black's g7-Bishop out of the game. After O-O-O we are ready to play g2-g4 or h4-h5 if possible. }) (4... Bg7 5. Bf4 { White protects the e5 pawn this way, followed by Qd2 and Nf3. 5. f4 is a fine alternative here, with many games played and usually White gets a solid space advantage with that line too. 5.Be3 is also possible, and we take a look at this variation from the move-order 2... Bg7 3. Nc3 c6 4. Be3, see below. } 5... f6 (5... Nd7 6. Qd2 f6 (6... Nf8 { The Knight is preparing to come to e6 at the opportune moment, meanwhile he opens up the diagonal for his light-squared Bishop. } 7. O-O-O h5 8. Bd3 Nh6 9. h3 Bf5 10. Kb1 Ne6 11. Nge2 Bxd3 12. Qxd3 Nf5 13. Bc1 { the position remains very complex, however White's position should be preferable because of his extra space advantage. The Bishop on g7 for the moment is very passive. }) 7. Nf3 g5 { Here White even has the sacrifice } 8. Bxg5 fxg5 9. Qxg5 Kf8 (9... Bh6 10. Qh5+ Kf8 11. e6 { White wins his piece back, plus an extra pawn. } 11... Qe8 12. exd7 Qxh5 13. d8=Q+ Qe8 14. Qxe8+ Kxe8 15. Bd3 { White is a pawn up and will have pleasant pressure against Black's backward e-pawn after 0-0 and Rfe1, possibly followed by Ne5. A subsequent ...Rg8 can we answered by g2-g3, stopping Black's 'counterplay' on the g-file and limiting his dark-squared Bishop. }) 10. Qf4+ Ke8 11. Ng5 { Black can't defend against both of White's threats: Qf7# and Ne6. }) 6. Qd2 fxe5 7. dxe5 Nd7 { transposes to 4... Bg7 after }) 5. h3 { protecting the g4-square from the pin ...Bg4 and preparing to play Nf3 next move. } 5... Bh6 6. Nf3 Bxc1 7. Qxc1 Bf5 8. Rg1 { White is preparing to play g2-g4, when the Bishop on f5 has no comfortable squares. }) 4. Be3 { White can just play our usual setup with Qd2 etc. It's hard to see how Black can avoid playing ...Bg7 for long. }) 2. d4 { White occupies the centre with the perfect pawn duo on e4 and d4, a very natural move. } 2... Nf6 { We develop our Kingside Knight and attack the e4-pawn. Advancing with  3.e5?  fails to  3...dxe5  4.dxe5  Qxd1+  5.Kxd1  Ng4  when White is losing a pawn.   The most natural and logical move to protect e4 is  3.Nc3  . Hardly a surprise, it is by far the main move in this position, and after  3.Nc3  g6  we reach the starting position of the first 17 chapters in this course. But there are some alternatives for White.   We deal with  3.f3  in a separate chapter, while this chapter covers other moves that White may play, most importantly  3.Bd3  . Let's have a look at White's options on move three now. } { The Knight immediately attacks the e4-pawn. This reduces White's options, compared to playing  2...g6  or the similar @@StartFEN@@rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1@@EndFEN@@  1.e4  g6  2.d4  Bg7  , which allows White to play  3.c4  amongst others.   After  2...Nf6  White's overwhelming main move is  3.Nc3  , but in the Quickstarter we'll also have a look at  3.Bd3  and  3.f3 } 3. Nc3 { If } 3... g6 { After  3...g6  we have reached the starting position of the Pirc Defence. } { The Austrian Attack with } { This is the so-called '150' attack, and is my recommendation against the Pirc Defence. White's play is natural and easy to understand. He plays Qd2 (with the idea to play Bh6) and then, depending on Black's setup, he can go for normal development with Nf3, Bd3 or opt for the more aggressive setup with f3 and Queenside castling. Usually White does not need to fear the move ...Ng4. After Bg5 it turns out that only Black can have problems there. } 4. Be3 { White develops the Bishop to a natural square while still keeping many options open. The main virtue of  4.Be3  is its flexibility, which poses a challenge to Black.  White might intend to continue with Qd2, Bh6 and h2-h4-h5 to play for a first-round knockout, but there are other interpretations of the move, involving Nf3 and O-O. We need to check these various ideas by White to match White's flexible way of thinking.  However, before entertaining any sophisticated thoughts, we need to address the simple question: what is our reply to  4.Be3? } { This is the so-called '150' attack, and is my recommendation against the Pirc Defence. White's play is natural and easy to understand. He plays Qd2, (with the idea to play Bh6) then depending on Black's setup he can go for normal development with Nf3, Bd3 or opt for the more aggressive setup with f3 and Queenside castling. Usually White does not need to fear the move ...Ng4. After Bg5 it turns out that only Black can have problems there. } { This is the so-called '150' attack, and is my recommendation against the Pirc Defence. White's play is natural and easy to understand. He plays Qd2 (with the idea to play Bh6) and then, depending on Black's setup, he can go for normal development with Nf3, Bd3 or opt for the more aggressive setup with f3 and Queenside castling. Usually White does not need to fear the move ...Ng4. After Bg5 it turns out that only Black can have problems there. } 4... Ng4 { does not lead anywhere after } (4... c6 { In this move-order, we'll look at tries where Black aims to delay playing ...Bg7. } 5. Qd2 { After } 5... b5 (5... Ng4 { this Knight jump again leads nowhere: } 6. Bg5 h6 7. Bh4 g5 8. Bg3 { the Bishop dance to g3 takes the sting out of Black's ...Ng4 idea, and he cannot grab our dark-squared Bishop. } 8... Bg7 (8... Nf6 9. f3 Bg7 10. Nge2 Nbd7 11. Bf2 { White follows up with Ng3, achieving a clear advantage. }) 9. h4 { wins for White. Black has weakened his Kingside and he is too far behind in development. }) (5... Nbd7 6. Nf3 b5 (6... Qc7 7. Bh6 { Taking advantage of Black's weakened dark-squares on the Kingside, White hopes to exploit this and starts a quick initiative before Black is fully developed. The other approach is 7.a4 which is very logical too. Black is prevented from expanding on the Queenside with ...b7-b5, and it's much harder for him to create play. } { Taking advantage of Black's weakened dark-squares on the Kingside, White hopes to exploit this and starts a quick initiative before Black is fully developed. } 7... b5 8. a3 { After } 8... Bb7 (8... a6 9. Bd3 c5 10. d5 { I prefer closing the center rather than playing Sicilian positions with 10.O-O cxd4 11.Nxd4 Bxh6 12.Qxh6 Bb7 ∞ when Black has more chances to create counterplay in this case. He controls the d5-square and it's not clear how White is able to make progress. } 10... Ng8 { Black had to get rid of the annoying pressure on his h6-g7 dark-squares. } 11. Bxf8 Kxf8 12. O-O Kg7 13. a4 b4 14. Nd1 Ngf6 15. Ne3 Re8 16. a5 Bb7 17. c4 { and White keeps a small but stable advantage, thanks to his extra space. }) 9. Bd3 { now the normal continuation for Black is } 9... a6 10. O-O c5 { but White closes the center with } 11. d5 { shutting down the enemy Bishop on b7 from the game. } 11... Bxh6 12. Qxh6 O-O-O 13. Rfb1 { White does not fool around. He starts an immediate attack on the Black King's residence with the move b2-b4 and a3-a4. } 13... e6 (13... Kb8 14. b4 cxb4 15. Na2 bxa3 16. Nb4 { the attack on the Queenside is really powerful and dangerous to meet. }) 14. Ng5 { wins a pawn thanks to the threat on f7. }) 7. e5 { is better for White, even after the opponent's best defence: } 7... b4 8. exf6 bxc3 9. Qxc3 Nxf6 10. Qxc6+ Bd7 { Black gets some lead in development in return for the pawn. } 11. Qa6 Rb8 12. b3 Qc7 (12... Nd5 13. Bd2 { There is no need to give up the Bishop pair. After this move, White can finally complete his development with Be2 and O-O. } 13... Bg7 14. Be2 O-O 15. O-O Qc7 16. Rac1 Nc3 17. Bc4 { Black does not get sufficient compensation for his sacrificed pawn. }) 13. Rc1 { keeps everything protected in White's camp. }) 6. Bd3 Nbd7 7. Nf3 e5 8. O-O Bb7 9. dxe5 dxe5 10. a4 a6 11. Rfd1) (4... a6 { Playing  4...a6  first is an essential move order nuance that we discussed in the 'Intro and Sidelines chapter'here.  The move is directed against White's most aggressive setups that involve Queenside castling and a quick Qd2 & Bh6 idea. In the current chapter, we will examine these ideas.  White usually starts with  5.Qd2  but you'll also meet  5.f3  frequently, which will often transpose, as a later Qd2 is very natural. Of course, White does have many other options on move five, but these are discussed in the mentioned Intro and Sidelines chapter. } { The move  4...a6!  is not the only playable move against 4.Be3, but we still award it an exclamation mark. It is essential to realize that the natural move  4...Bg7?!  does not fit the bill. This move looks like an automatic choice. We indeed continue like that in most cases, for example, after @@StartFEN@@rnbqkb1r/ppp1pp1p/3p1np1/8/3PP3/2N5/PPP2PPP/R1BQKBNR w KQkq - 0 4@@EndFEN@@  4.f4  or  4.Nf3  .  However, against  4.Be3  , there is a concrete problem: White has the aggressive attacking plan of 5.Qd2, followed by Bh6. This straightforward approach is very effective. After Bh6, Black either needs to take the Bishop, losing more time @@StartBracket@@...Bf8-g7-h6@@EndBracket@@, or castle into the murderous h4-h5 attack.   It sounds harsh, but  4...Bg7?!  5.Qd2  is not only better for White but would also be very simple to play for our opponent. We need to be more cunning and therefore suggest a different approach. If  4...Bg7?!  is out of contention, the moves  4...c6  and  4...a6  are the main ideas for Black. Now, this is the moment to consider that White has the option of the caveman attack but might switch to a slower approach and continue with Nf3 and castle Kingside. This means we need to select a move that also fits into these scenarios. If you intend to play  4...c6  , you also need to play with ...c6 against the Classical system with 4.Nf3. This approach is chosen by Pirc expert Mihail Marin in his GM Repertoire book, for example.  We think that playing with  4...a6!  is an exciting and less explored option for Black. It turns out that the transpositions into the Classical are no problem, as ...a6 is a viable and interesting reply to these lines, as well. Now, how does it continue from here? We want to organize a quick counterplay on the Queenside and delay developing our Kingside Bishop.  With  4...a6  , we like to wait and see what White's plan is. Here's an overview of White's ideas:  A. Go for the Kingside attack and usually castle Queenside. The starting moves for this idea are  5.Qd2  and  5.f3  , which we discuss in a dedicated chapter.  B. White does not intend to throw the kitchen sink with f3 & g4 but develops with  5.Nf3  . This still could involve aggressive ideas with Qd2 and Bh6, but it might also just prepare O-O and lead to calmer play. This approach is covered in a dedicated chapter that covers the Nf3+Be3 combinationhere.  C. White plays  5.h3  , which is not as popular as A and B but is challenging. This move tells us that White is not after h4-h5 ideas, but might wants to change gears and go for f4!?   5.h3  was recommended in Christof's Keep It Simple: 1.e4 and Wesley So's Lifetime Repertoires: 1.e4, so we need to be prepared. It is covered in the present chapter.  D. Other ideas on move five are covered in the current chapter. Many are transpositional and relatively unexplored. In practice, you'll face plan A most of the time, particularly in online games or at club level.  White's play looks aggressive, which is attractive to many 1.e4 players. Plan C is less common, but this might change in the future, given that it was recommended in popular courses on Chessable. } 5. h3 { White answers our small pawn move on the Queenside with a small pawn move on the Kingside, claiming that it is worth a tempo to cover the g4-square. This approach looks slow, but it carries a serious punch, as we will see in this chapter.  Before we get to the move-by-move coverage, we need to mention that the line  5.h3  is not very popular for White, but this might change, as it was covered in two important publications on Chessable. In 2018 it was first covered by one of the authors of this course, Christof Sielecki, in 'Keep It Simple: 1.e4'. Two years later, Wesley So recommended it in his 'Lifetime Repertoires: 1.e4'.  Alright, back to the current position. Black's next is fairly natural. We complete the Kingside fianchetto. } { White controls g4, taking it away from Black's pieces while also preparing g2-g4 in some cases. } 5... b5 { is bad concretely thanks to } (5... e6 { has been played by Ian Nepomniatchi in 2019. Black's idea is to play ...b7-b5 without having to worry about e4-e5 because now he controls the d5-square. I suggest } 6. Qf3 { preparing to meet ...b5 with e4-e5. The position after 6.g4 b5 7.Bg2 Bb7 8.a3 Bg7 9.Nge2 Nbd7 10.f4 O-O 11.O-O Rc8 seems to me to be quite complex. And 6.Bd3 which is what Shankland played, Black can reply with b5 7.a4 Maybe White can try the weird move 7.Nb1 !? Bb7 8.Nd2 c5 9.c3 Bg7 10.Ngf3 O-O 11.O-O when his center is well-protected and he is slightly better thanks to his space advantage. 7.Nce2 Bb7 8.Ng3 h5 ! this annoys the white Knight on g3 a little bit, thanks to the threat of ... h5-h4, and h4 will give away the g4-square to Black. 7...b4 8.Nce2 Bb7 9.Ng3 c5 10.c3 h5 ! when Black is not without counterplay. } 6... d5 (6... Nbd7 7. O-O-O Bg7 8. g4 O-O 9. Kb1 { White's King is safe and solid and he has a nice space advantage in the center and on the Kingside. } 9... b5 { is still met by the annoying } (9... Qe7 { White's King is safe and solid and he has a nice space advantage on the center and on the Kingside. } 10. h4 { Threatening to start a powerful pawn storm on the enemy King. } 10... c5 11. dxc5 Nxc5 { The extremely powerful move } 12. e5 { The idea is that after } 12... dxe5 13. h5 { Black can't play ...b5 right away, so 12. e5!? slowed down Black's Queenside counterplay. } 13... e4 14. Qh3 b5 15. hxg6 fxg6 16. Be2 { White is threatening to play g4-g5, starting a powerful attack. }) 10. e5) 7. Bd3 { The move order 7.e5 is inferior due to 7...Nfd7 8.Bd3 c5 when White has no time to complete his ideal setup with 9.Nce2 ?? due to 9...c4 } 7... b5 8. e5 Nfd7 9. Nce2 c5 10. c3 b4 11. Qg3 { White follows up with Nf3 next move, and I think that he has a clear advantage, thanks to his control of the center and the possibility to attack the dark-squares. }) (5... Nbd7 { can be met by } 6. Nf3 b5 (6... e5 7. Bc4 b5 (7... Bg7 8. dxe5 dxe5 9. a4 O-O 10. O-O Qe7 11. Qe2 Nc5 12. Bg5 { A deep move. White wants to bring his Bishop to the a3-f8 diagonal, but he provokes Black into weakening his Kingside first. } 12... c6 13. a5 h6 14. Bc1 Re8 15. b3 Ne6 16. Na4 { when White has a small edge thanks to his bind on the Queenside. Talpak,T -Nyvlt,Z ICCF email 2015. }) 8. dxe5 dxe5 9. Bd5 Rb8 { leads to a worse position for Black: } 10. Bc6 Bd6 11. a4 b4 12. Nd5 Nxd5 13. Qxd5 O-O 14. O-O Nf6 15. Qc4 { Black's position is difficult to defend. White is threatening 15...— 16.Ba7 and Black's light-squared Bishop can't move without losing the a-pawn. }) 7. e5 Nh5 8. Ng5 { with the threat of e5-e6 is in White's favour. }) (5... Bg7 { A perfectly normal move, but we need to talk about it for a moment. One move earlier, we avoided @@StartFEN@@rnbqkb1r/ppp1pp1p/3p1np1/8/3PP3/2N1B3/PPP2PPP/R2QKBNR b KQkq - 1 4@@EndFEN@@  4...Bg7?!  , as we were afraid of the caveman-style attack involving Qd2, Bh6 and h4-h5.   After the slow @@StartFEN@@rnbqkb1r/1pp1pp1p/p2p1np1/8/3PP3/2N1B3/PPP2PPP/R2QKBNR w KQkq - 0 5@@EndFEN@@  5.h3  this idea is not scary anymore. Therefore  5...Bg7  makes perfect sense.  However, why not  5...b5?  Didn't we prepare this pawn push with 4...a6? Yes, but here it would be badly timed. After  5...b5?  6.e5!  a key point of 5.h3 is revealed. Black can't answer this advance with ...Ng4 and lines like  6...dxe5  7.dxe5  Nfd7  8.Qf3  is awful for Black. It's crucial to avoid @@StartFEN@@rnbqkb1r/1pp1pp1p/p2p1np1/8/3PP3/2N1B2P/PPP2PP1/R2QKBNR b KQkq - 0 5@@EndFEN@@  5...b5?  and preserve this option for a better moment.  Now, after  5...Bg7  , we will cover the moves  6.Qd2  ,  6.g4  and the most important one  6.f4  in the current chapter. White also frequently plays  6.Nf3  or  6.a4  O-O  7.Nf3  , when we transpose to the chapter on @@StartFEN@@rnbqkb1r/ppp1pp1p/3p1np1/8/3PP3/2N5/PPP2PPP/R1BQKBNR w KQkq - 0 4@@EndFEN@@  4.Be3  a6  5.Nf3 } { A perfectly normal move, but we need to talk about it for a moment. One move earlier, we avoided @@StartFEN@@rnbqkb1r/ppp1pp1p/3p1np1/8/3PP3/2N1B3/PPP2PPP/R2QKBNR b KQkq - 1 4@@EndFEN@@  4...Bg7?!  , as we were afraid of the caveman-style attack involving Qd2, Bh6 and h4-h5.   After the slow @@StartFEN@@rnbqkb1r/1pp1pp1p/p2p1np1/8/3PP3/2N1B3/PPP2PPP/R2QKBNR w KQkq - 0 5@@EndFEN@@  5.h3  this idea is not scary anymore. Therefore  5...Bg7  makes perfect sense.  However, why not  5...b5?  Didn't we prepare this pawn push with 4...a6? Yes, but here it would be badly timed. After  5...b5?  6.e5!  a key point of 5.h3 is revealed. Black can't answer this advance with ...Ng4 and lines like  6...dxe5  7.dxe5  Nfd7  8.Qf3  is awful for Black. It's crucial to avoid @@StartFEN@@rnbqkb1r/1pp1pp1p/p2p1np1/8/3PP3/2N1B2P/PPP2PP1/R2QKBNR b KQkq - 0 5@@EndFEN@@  5...b5?  and preserve this option for a better moment.  Now, after  5...Bg7  , we will cover the moves  6.Qd2  ,  6.g4  and the most important one  6.f4  in the main course. White also frequently plays  6.Nf3  or  6.a4  O-O  7.Nf3  , when we transpose to the chapter on @@StartFEN@@rnbqkb1r/ppp1pp1p/3p1np1/8/3PP3/2N5/PPP2PPP/R1BQKBNR w KQkq - 0 4@@EndFEN@@  4.Be3  a6  5.Nf3 } 6. f4 { This is the most aggressive and critical move. It was recommended in both Chessable courses mentioned earlier. We'll discuss some ideas after seeing Black's reply. } { White may also consider playing 6.g4 with the idea to put the Bishop on g2, and develop the Knight to e2, leading to a harmonious development of the pieces. } 6... O-O 7. Nf3 { White seized control of the center, and now he is ready to breakthrough with e4-e5 at the opportune moment. Or } { White seized control of the center, and now he is ready to breakthrough with e4-e5 at the opportune moment. } 7... b5 (7... Nc6 8. e5 Nd7 9. a3 { Controlling the b4-square. 9.Bd3 Nb4 would allow Black some counterplay as he gains a tempo by attacking our Bishop. } 9... b5 10. Bd3 Nb6 11. Qe2 f6 12. d5 Na5 13. e6 f5 14. Bd4 c5 15. Bxg7 Kxg7 16. g4 { and White has a powerful attack, as after } 16... c4 17. Bxf5 gxf5 18. Rg1 Kh8 19. gxf5 { it is impossible to defend Black's King on h8. }) (7... e6 8. Qe2 { White prepares to play e4-e5, followed by castling long. This move is rare but a very ambitious one. There is nothing wrong with 8.Bd3 and this is the standard move. White controls the light-squares and is also preparing to develop behind his powerful central pawns. } { White prepares to play e4-e5, followed by castling long. This move is rare but a very ambitious one. } 8... b5 9. e5 Nd5 (9... Nfd7 10. h4 { This is the idea behind the move 8. Qe2. White starts a quick and powerful attack on the Kingside. } 10... Bb7 (10... c5 { Black has to break in the center before it is too late. } 11. exd6 { After } 11... Bb7 (11... cxd4 12. Bxd4 Bxd4 13. Nxd4 Nf6 14. O-O-O Qxd6 15. g3 Qb6 16. h5 { White has the clearly better position, for example the game continued: } { White has the clearly better position, for example: } { White has the clearly better position, for example, the game continued: 16...Rd8 17.Bg2 Ra7 18.Qe5 Nxh5 19.Rxh5 Nd7 20.Qg5 f6 21.Qh4 Nf8 It's too dangerous to accept the sacrifice: 21...gxh5 22.Nxe6 ! b4 23.Qxh5 Nf8 23...Qxe6 ? allows 24.Bd5 +- 23...bxc3 ? 24.Qg4+ followed by Qg7+ wins. 24.Nxd8 bxc3 25.Bd5+ Kg7 26.Bb3 +- White regained the sacrificed material @@StartBracket@@he is even a pawn up@@EndBracket@@, but more importantly, the black King remains very vulnerable. 22.Rd5 ! exd5 23.Nxd5 Rxd5 24.Bxd5+ Kg7 25.g4 White had a strong initiative in the game De Bari, V-Nyvlt, Z 2017. } 16... Nxh5 (16... Rd8 17. Bg2 Ra7 18. Qe5 Nxh5 19. Rxh5 Nd7 20. Qg5 f6 21. Qh4 Nf8 { It's too dangerous to accept the sacrifice: 21...gxh5 22.Nxe6 ! b4 23.Qxh5 Nf8 23...Qxe6 ? allows 24.Bd5 +- 23...bxc3 ? 24.Qg4+ followed by Qg7+ wins. 24.Nxd8 bxc3 25.Bd5+ Kg7 26.Bb3 +- White regained the sacrificed material @@StartBracket@@he is even a pawn up@@EndBracket@@, but more importantly, the black King remains very vulnerable. } 22. Rd5 exd5 23. Nxd5 Rxd5 24. Bxd5+ Kg7 25. g4 { White has a strong initiative in the game De Bari,V-Nyvlt,Z 2017. }) 17. Rxh5 gxh5 18. Qxh5 f6 19. Bh3 Ra7 20. Nd5 exd5 21. Bxc8 { and Black cannot recapture on c8 because of Qg4+. }) 12. h5 cxd4 13. Bxd4 Bxf3 14. Qxf3 Bxd4 15. Qxa8 Qa5 16. Qf3 Rc8 { it may seem that Black creates powerful counterplay, but thanks to his material advantage and pressure on the h-file White should convert his material advantage after } 17. O-O-O Bxc3 18. hxg6 hxg6 19. bxc3 Rxc3 20. Qf2 Qxa2 21. Rh8+ { A very important move. White wins. } 21... Kxh8 22. Qd4+ f6 23. Qxc3) 11. h5 c5 { this feels like it's going to lead to a quick victory for White: } 12. hxg6 hxg6 13. O-O-O cxd4 14. Rxd4 { White is prepared to give up the exchange in favour of his Kingside attack. } 14... dxe5 15. fxe5 Nc6 16. Rxd7 Qxd7 17. Qf2 { followed by Qh4, when Black's King is permanently vulnerable. }) 10. Nxd5 exd5 11. O-O-O f6 12. exd6 Qxd6 13. g4 Re8 14. Kb1 Nc6 15. Qf2 { White has a solid and stable edge here. }) 8. e5 { After } 8... Nh5 (8... dxe5 9. dxe5 Nfd7 10. Bd3 { leads to a dominating position for White. }) (8... Nfd7 9. h4 { leads to a powerful attack for White, for example: } 9... c5 10. h5 cxd4 (10... Nc6 11. hxg6 hxg6 12. d5 { It might be even stronger to continue with 12.e6 !? Nf6 12...fxe6 13.Bd3 leads to a winning attack. 13.exf7+ Rxf7 and now White has a good choice between 14.Bd3 or 14.dxc5 and in both cases, he has a dangerous initiative. } 12... Nd4 13. Nxd4 cxd4 14. Qxd4 dxe5 15. fxe5 Nxe5 16. Qh4 { Black's King is in permanent danger. } 16... f6 17. O-O-O Bf5 18. Be2 Rc8 19. d6 { Black is still in danger. White always has the threat of Qh7+ followed by Bh6 at the right time. }) 11. Qxd4 dxe5 12. fxe5 Nc6 13. Qh4 { does not really improve things for Black. }) 9. Rg1 Ng3 10. Bd3 e6 11. Ne4 { White has a clear advantage thanks to his powerful pawns in the center. }) 6. e5 { now Black no longer has the Knight jump to g4, and he is in serious trouble: } 6... Nfd7 7. Qf3 Nb6 8. a4 b4 (8... bxa4 9. Nxa4 N8d7 { Now White has a number of good continuations. One of them is } 10. h4 { with the idea to open up the h-file with h4-h5. } 10... dxe5 11. Nxb6 Nxb6 12. dxe5 Qd5 13. Bxb6 Qxf3 14. Nxf3 cxb6 15. Bb5+ Bd7 16. Bxd7+ Kxd7 17. O-O-O+ { White has a clearly better endgame. }) 9. Ne4 { with the threat of a4-a5 is also very dangerous. }) (4... Bg7 { transposes to the Pirc Defence. } { Black can also develop his Queenside first before playing ...Bg7, but it's not clear that approach is advantageous for him. } 5. Qd2 { After } 5... O-O (5... Ng4 { again leads nowhere after } 6. Bg5 h6 7. Bh4 g5 8. Bg3 { The Bishop feels very secure on g3, and he can exploit the weaknesses created on Black's Kingside. } 8... f5 (8... Nf6 9. f3 Nc6 10. O-O-O { leads to a very pleasant position for White. }) (8... e5 9. d5 { Black can try } { White can confidently advance his d-pawn and close the position, knowing that Black's light-square weaknesses will not go away. } 9... f5 (9... h5 { but his position is simply bad. } 10. h4 { Fixing Black's weak Kingside pawns. } 10... Bh6 11. Qe2 gxh4 12. Bxh4 Bg5 13. Bxg5 Qxg5 14. Nf3 Qh6 15. Nd2 { White follows with O-O-O next move, and he has a clearly better position, thanks to his better pawn structure and superior placed pieces. }) 10. exf5 Bxf5 11. f3 Nf6 12. O-O-O Nbd7 13. Bf2 { White is ready to play Nge2-g3 next move, controlling the squares f5 and e4 with a clear advantage. Juras,Z -Bellisario, C ICCF email 2016. }) 9. exf5 Bxf5 10. O-O-O { Black's light-squares on the Kingside are simply too weak. } 10... Qd7 11. h4 Nc6 12. f3 gxh4 13. Bxh4 Nf6 14. g4 Bh7 15. Bh3 { White's position is just absolutely crushing in Traut,W -Bialas,T GER email 2017. }) (5... a6 { is met by } 6. Bh6 { disrupting the coordination of Black's pieces. } 6... O-O { seems suicidal. After } (6... Bxh6 7. Qxh6 b5 { is just bad due to } 8. e5 Nfd7 9. Nf3 { when Black's Kingside is under heavy pressure due to the constant threat of Qg7, etc. }) 7. O-O-O b5 8. f3 { followed by a quick h4-h5, it's hard to believe that Black will be able to survive the Kingside onslaught. } { followed by h4-h5 looks bad for Black. }) (5... c6 { This is the main defence for Black. He controls the d5-and b5-squares, preparing to create play on the Queenside by pushing his pawns there, or to put a solid stake in the center with ...Nbd7 followed by ...e7-e5. He also delays castling and waits for an opportune moment to do so. } 6. Nf3 { White develops his Kingside pieces and prepares to support his center with the move Bd3. This is my recommendation, but White has a good alternative here. } { A rare but interesting possibility here is } { White develops his Kingside pieces and prepares to support his center with the move Bd3. This is my recommendation. } (6. Bh6 { is also a good try for White, and his play is very logical. } 6... Bxh6 7. Qxh6 { Black's main idea here is to play } 7... Qa5 { creating some counterplay in the center. For starters, he is threatening to swindle us by winning a pawn with the move ...Nxe4. The move 7...e5 is perhaps more solid but in my opinion White is also slightly for choice after 8.Nf3 Qe7 9.dxe5 dxe5 10.Bc4 with the idea to exploit the weakness of the f7-pawn with Ng5. } 8. Bd3 c5 9. d5 { 9.Nf3 is the other way for White to fight for an advantage. After 9...cxd4 10.Nxd4 Nc6 11.Bb5 Bd7 12.O-O-O he has decent practical chances. } 9... Nbd7 10. O-O-O { and now the point of Black's variation is he has the move } 10... b5 11. Bxb5 Rb8 { starting counterplay on the Queenside in return for the pawn. It's not clear yet whether Black's long-term compensation is sufficient and I feel that White should also be better in this variation. }) 6... Ng4 { this time White can reply with } (6... Qa5 { which is actually a decent option. Black activates his Queen and puts pressure on the e1-a5 diagonal and keeps an eye over some squares in the fifth rank. Against this move White has a number of good replies and that makes it hard to choose. } 7. Bd3 { White keeps e4 protected and simply aims to finish his Kingside development. I was also choosing between this and the alternatives 7.Be2 or 7.h3 which also looks nice for White. In the end, I decided to recommend 7. Bd3, as it has more games in practice. } 7... O-O { If Black castles short, we can do the same. } (7... b5 { is dubious. } 8. O-O { Now the black Queen on a5 is misplaced and not doing much. } 8... Nbd7 9. e5 dxe5 10. dxe5 Ng4 11. e6 { with this powerful move we seize the initiative, because after the natural reply } 11... fxe6 { we have the concrete blow } 12. Nxb5 Qxd2 13. Nc7+ { winning material, because Black cannot play ...Kd8 due to Nxe6+. }) (7... Ng4 { does not lead anywhere after } 8. Bg5 { White is actually threatening to take on e7, followed by Nd5+ taking advantage of the undefended Queen on a5. } 8... e5 9. dxe5 dxe5 10. h3 Nf6 11. O-O { Black has forced us to take on e5 and simplify the position a bit, but he is still slightly worse as we have some pressure on some squares in his camp. } 11... O-O 12. Be3 Nbd7 13. Nd5 { This is a nice and easy to miss trick. White is able to gain certain advantages attacking the enemy Queen and rerouting our Knight to a better place. } 13... Qxd2 14. Ne7+ Kh8 15. Nxd2 { White gains the Bishop pair in the endgame. } 15... Re8 16. Nxc8 Rexc8 17. Rfd1 { White is a little better in the endgame thanks in part to the Bishop pair. We are ready to improve our position by advancing our pawns with a4, and possibly g4-g5 later on. }) (7... Nbd7 { can be met by } 8. O-O e5 { loses to the nice trick } (8... O-O { Here White may play the natural move 9.h3, but I suggest } 9. Nd5 { hitting the e7-pawn and threatening to take it with check. Therefore, forcing the enemy Queen to go back. } 9... Qd8 10. Nxf6+ Nxf6 11. h3 Qc7 12. a4 { White has a small but stable advantage, thanks to our well-coordinated pieces and space advantage. } { White has a small but stable advantage, thanks to our well coordinated pieces and more space. } 12... e5 13. dxe5 dxe5 14. a5 { This fixes Black's Queenside pawns and takes control of the b6-square. } 14... Be6 (14... Re8 15. Rfd1 Be6 16. Ng5 { White has some definite pressure in this position. }) 15. Ng5 { gains a tempo on the Bishop. } 15... Bc8 16. Bc5 Rd8 17. Qe3 { this puts unpleasant pressure on Black's Queenside pawns. }) 9. Nb5 { when White wins a full pawn thanks to some pretty tactics. } 9... Qxd2 10. Nxd6+ Ke7 11. Nxc8+ Raxc8 12. Bxd2 exd4 13. Rfe1 { White takes on d4 next, winning the pawn. Otherwise if } 13... c5 14. e5 Nd5 15. Be4 { our Bishops become very strong, and the black King becomes vulnerable in the center. }) (7... Bg4 8. Nh4 { This is a good reply to ...Bg4 sorties. The Knight is active here, and we want to kick the enemy Bishop next move with h2-h3. } 8... Qh5 { is well met by } (8... e5 9. h3 Be6 10. f4 { White could also play at a quieter pace with 10. Nf3, or 10. dxe5 followed by Nf3, but I see no point why we should avoid gaining some extra space on the Kingside. } 10... exd4 11. Bxd4 c5 { This aims to get some counterplay on the dark-squares, as otherwise White will just castle short and continue his normal development. } 12. Be3 Nc6 13. f5 { Pushing the enemy Bishop back and gaining some space. } 13... Bd7 14. O-O O-O { Now White may consider playing 15. g4, with the idea of g5, trapping Black's pieces in the corner. But I suggest another move } 15. Rf2 { the idea of which is to double Rooks on the f-file, and exerting pressure on the enemy pieces. White is better, and our position is much easier to play. A possible continuation here is } 15... Rae8 16. Raf1 c4 { Black has to create some counterplay on the e4-pawn, otherwise the attack just crashes through. } 17. fxg6 cxd3 { The materialistic approach doesn't work for him. } (17... fxg6 18. Bxc4+ Be6 19. Bxe6+ Rxe6 20. Bh6 { Trading the Bishops helps us to put more pressure on the Kingside. } 20... Qc5 21. Kh1 { Black has insufficient compensation for his missing pawn. }) 18. Rxf6 Bxf6 (18... fxg6 19. Rxf8+ Rxf8 20. Rxf8+ { followed by cxd3 leaves White a clear pawn up. }) 19. gxh7+ Kg7 20. Bh6+ { wins for White. }) 9. g3 { when the Queen and the Bishop could get trapped in their uncomfortable position. } 9... O-O { is a big mistake as } 10. h3 Bd7 11. e5 { traps the black Queen. } 11... dxe5 12. Be2 exd4 13. Bxh5 dxe3 14. Qxe3 { followed by castling long, with a winning position. }) 8. O-O { We could also play 8.h3 , taking control of the g4-square, but it's not necessary yet. } 8... Bg4 9. Ne1 { White has other moves here, but this seems strongest. We plan to kick the enemy Bishop back next move with h2-h3. } 9... e5 10. h3 Be6 11. f4 { This works well in conjunction with 9. Ne1, as White fights for the initiative on the Kingside. } 11... exd4 (11... exf4 12. Rxf4 Nbd7 (12... c5 { I assume that this is Black's best try, in order to fight for the dark-squares. } 13. d5 Bc8 14. Nf3 Nbd7 15. Rh4 { Black has some control over the e5-square, but we continue our attack on the Kingside nevertheless. We want to follow up next with Bh6 or simply Rf1, bringing the last Rook to the game. } 15... Qd8 16. Bg5 { The pin on the Knight is quite unpleasant, and White is preventing the opponent from consolidating with ... Nh5 followed by ...Ne5. } 16... h5 17. Rf1 Qb6 18. Be3 { White has some initiative. We could continue the attack next move with g2-g4. }) 13. Rh4 { White continues with his simple attacking plan of Bh6. } 13... Ne8 14. Nf3 f6 15. d5 Bf7 16. Bh6 g5 17. Bxg7 Nxg7 18. Rh6 { White has good attacking chances on the Kingside, especially our plan of e4-e5 next looks quite dangerous. }) 12. Bxd4 Nbd7 13. Nf3 Rae8 { the position looks easier to play for White, who now has a variety of plans. We can put a Rook on e1, or else go for } 14. Rab1 { with the idea to kick the enemy Queen away with b2-b4. White is better. }) (6... O-O { can be met by } 7. Bh6 { even with the Knight already on f3, the threat of h4-h5 is still quite annoying. } 7... b5 (7... Bxh6 8. Qxh6 Ng4 9. Qd2 Nf6 { Black forces the enemy Queen away from h6, but he has lost some time doing so. } 10. h3 b5 { is simply met by } (10... Re8 11. O-O-O { White easily prevents ...e7-e5, and now he creates threats of his own with Qh6 followed by breaking open the center. } 11... b5 12. e5 dxe5 13. Nxe5 b4 14. Na4 Qd6 15. f4 { White has a large advantage, thanks to his powerful control over the center. }) 11. Bd3 { threatening to break through in the center with e4-e5 next move. }) (7... d5 { is a fair possibility for Black. He creates counterplay in the center before White is able to start anything decisive on the Kingside. I suggest the move } 8. e5 Ne4 9. Nxe4 dxe4 10. Bxg7 Kxg7 11. Ng5 { Now thanks to the threats on the e4-pawn, White is able to pose Black some problems. } 11... c5 (11... Bf5 12. Rg1 { White is threatening to kick away the enemy Bishop with the move g2-g4. Black has to act quickly. } 12... c5 13. d5 { After 13.g4 Be6 14.dxc5 Qxd2+ 15.Kxd2 Nd7 16.Re1 White can also pressurize his opponent in the ending: Nxc5 17.Nxe4 Rfd8+ 18.Kc1 Rac8 19.b3 += Black still has to prove compensation here for his pawn. } { merely transposes back to 11... Bf5. }) 12. d5 Bf5 13. Rg1 { After 13.g4 Be6 14.dxc5 Qxd2+ 15.Kxd2 Nd7 16.Re1 White can also pressurize his opponent in the ending: Nxc5 17.Nxe4 Rfd8+ 18.Kc1 Rac8 19.b3 += Black still has to prove compensation here for his pawn. } { merely transposes back to 11... Bf5. } 13... h6 14. Nh3 { 14.g4 Be6 ! is working fine for Black, according to my analyses. } 14... Nd7 15. Qc3 Nb6 16. O-O-O Nxd5 17. Qa3 { Black still has to solve some problems here, thanks to the annoying pin on the d-file. I don't think many people will want to defend this variation with the black pieces, he has to find many accurate moves just to survive in the opening. }) (7... Nbd7 { Preparing to play ...e7-e5, and hoping to coordinate his pieces. Black also has other possibilities here: } { Preparing to play ...e7-e5, and hoping to coordinate his pieces. } 8. h4 e5 (8... Bxh6 9. Qxh6 Qa5 { is just a blunder since after } (9... Ng4 10. Qd2 { The other critical line is } 10... Ndf6 (10... h5 { Black stops h4-h5 once and for all, though in return White gets the outpost on g5 for his Knight. } 11. Ng5 { White immediately seizes the g5 outpost offered to his Knight. From there it exerts quite powerful pressure on the f7-and e6-squares. } 11... e5 (11... c5 12. d5 Ndf6 13. f3 Ne5 14. Be2 { White maintains with some pressure in the game Even,R -Hasselmeyer,A 2017. He has extra space, an outpost on g5, and he is threatening to pry open the Kingside with the move g2-g4 in many variations. }) 12. f3 Ngf6 13. O-O-O { gives White a stable and secure advantage, and against } 13... b5 14. g4 { is winning tactically by force: } 14... hxg4 (14... exd4 15. Ne2 Ne5 16. Nxd4 Qb6 17. gxh5 Nxh5 18. Rg1 { White's attack is way too powerful in Ciani,D -Hansen,L 2018. }) 15. h5 Nxh5 16. fxg4 Ng3 17. Rh3 exd4 18. Ne2 { this leads to a quick mate on the h-file. }) 11. O-O-O { when White has to know some lines here, but overall White remains with the superior position. } 11... b5 { needs to be met with the important move } (11... Qa5 12. Ne1 { Threatening to play f2-f3, trapping the enemy Knight on g4. Black has to respond quickly. } { Black's desperate piece sacrifice with } 12... b5 (12... c5 { He rescues the Knight by securing the e5-square, but unfortunately Black does not solve all his opening problems anyway. } 13. dxc5 Qxc5 14. Nd3 { Gaining a tempo by hitting the Queen. White is ready to either play f2-f3 or h4-h5 and retain a stable edge. For example, after } 14... Qb6 15. h5 Be6 16. hxg6 fxg6 17. Re1 Rac8 18. f3 Ne5 19. Nf4 Bf7 20. Ncd5 Nxd5 21. exd5 { White has a large advantage here. He has strong pressure along the h-file, and meanwhile, his King on the Queenside remains very safe from any counterattacks. }) 13. f3 b4 14. Nb1 Qxa2 15. h5 { does not give Black much relief, since White's attack along the h-file comes very quickly. }) 12. Ng5 { with multipurpose ideas. White protects the e4-pawn, prepares f2-f3, and also in many lines he can continue his Kingside attack with h4-h5. } { with multipurpose ideas. White protects the e4-pawn, prepares f2-f3, and also in many lines he can continue his Kingside attack with h4-h5. In case of } 12... b4 (12... Nh5 { And now White can continue with } 13. f3 b4 14. Nb1 Ngf6 15. g4 Ng3 16. Rh2 Nxf1 17. Rxf1 h5 18. Rg2 hxg4 19. fxg4 { when he maintains a powerful initiative on the Kingside. }) 13. Na4 h6 14. f3 hxg5 15. hxg5 Nh7 16. fxg4 { White regains his piece with a better position. }) 10. Ng5 { there is no stopping White's attack on the Kingside: } 10... e5 11. O-O-O exd4 12. Rxd4 Ne5 13. Be2 { he prevents the move ...Ne5-g4, after which Black has hardly any moves left. }) 9. h5 Nxh5 10. O-O-O { gives White more than enough compensation for the pawn. He is threatening to continue with the move g2-g4 next, shattering Black's Kingside defences. Even after the accurate reply } 10... Re8 11. g4 Nf4 { White still keeps a stable advantage after } 12. Bxg7 Kxg7 13. dxe5 dxe5 14. Nxe5 Rxe5 15. Qxf4 Qg5 16. Qxg5 Rxg5 17. Be2 { White is clearly better in the endgame. He is following next with f2-f4, and he keeps strong pressure on the h-file and on the open d-file. }) 8. a3 Qb6 9. h4 Bxh6 10. Qxh6 Ng4 11. Qd2 h5 12. Be2 { clearly favours White. }) (6... Nbd7 7. Bh6 Bxh6 8. Qxh6 e5 9. O-O-O Qe7 { White has quite a stable advantage thanks to his extra space and pressure on the Kingside, albeit it's not so easy to make progress. Here the computer likes the move } 10. a4 { which is paradoxical, but makes good sense. White prevents the counterplay with ...b7-b5, and prepares to develop his Bishop comfortably on c4. Black has some problems with his development and the fact that his King is stuck in the center for a while. } 10... a6 { is met by } 11. a5 { further preventing Black's pawn break on the Queenside. }) (6... b5 7. Bd3 { we transpose to the Pirc Defence, analysed under the move-order 1. e4 d6. } { White protects his e4-pawn, while also developing the rest of his Kingside pieces. } 7... Nbd7 (7... Bg4 { can be met by } 8. e5 { provoking some action in the center and taking advantage that Black has no ...Ng4 as a reply. This is what many strong players choose to play when they get this position as White, therefore this is what we shall analyse. 8.Nh4 followed by h2-h3 is a possible alternative. Personally my preferred move is 8.a4 b4 9.Ne2 when White does not mind getting the doubled pawns at all. Bxf3 After 9...a5 White may consider the move 10.Ng5 !? followed by h2-h3, kicking away the enemy Bishop. 10.gxf3 a5 11.h4 The doubled pawns are not felt, meanwhile White has an active plan of putting pressure on g6 by h4-h5 or f4-f5. } 8... Nh5 { is a possible move by Black. We reply } (8... Nfd7 9. exd6 exd6 10. Bg5 f6 11. Bh6 O-O 12. O-O-O d5 13. h4 { White has a large advantage and the threat of h4-h5 is very annoying. }) (8... b4 { This is Black's best defence. He creates a counter by attacking our Knight on c3. } 9. Ne4 Nd5 { is simply met by } (9... Nxe4 10. Bxe4 d5 (10... a5 11. a3 { Creating targets to attack on the enemy Queenside. } 11... bxa3 12. Rxa3 O-O 13. O-O { After } 13... Bxf3 (13... d5 14. Bd3 Bxf3 15. gxf3 c5 { This is the best way for Black to create counterplay, as otherwise White will just pick up the a-pawn with b2-b4. } 16. Bb5 { White dominates the black Knight on b8. } 16... Qb6 17. c4 dxc4 18. Bxc4 cxd4 19. Bxd4 Qd8 20. Rd3 Nc6 21. Bc3 Qc8 22. e6 { Black's pawn structure is ruined and exchanging dark-squared Bishops is a simple yet effective plan. } 22... fxe6 23. Re1 Nd8 24. Re4 Bxc3 25. Rxc3 Qb7 26. Rd3 { the variation leading here was quite complex and by no means forced, but in the game Greig,S -Tanis,C ICCF email 2014, White managed to keep some initiative thanks to his pressure on the d and e-files. }) 14. Bxf3 dxe5 15. dxe5 Qxd2 16. Bxd2 Bxe5 17. c3 { White has a small endgame advantage thanks to his Bishop pair and he is going to regain his pawn back next move after Rfa1. }) 11. Bd3 Bxf3 12. gxf3 { The doubled pawns are not really a problem for White since he has pressure on the half open g-file. h4-h5 is coming next very quickly. } 12... Qb6 13. h4 Nd7 14. h5 { led to a solid advantage for White in Dumortier,T -Lucio,J ICCF email 2015. }) 10. Bh6 { with a clear advantage thanks to Black's vulnerable Kingside. For example, the natural } 10... O-O { loses right away due to } 11. h4 { followed by h5. }) 9. exd6 { White keeps a stable advantage after } 9... Bxf3 (9... exd6 10. Ng5 O-O 11. f3 Bc8 12. O-O-O b4 13. Ne2 Re8 14. h4 { White is preparing to start a Kingside attack with g4-h5, with a comfortable initiative. }) 10. dxe7 Qxe7 11. gxf3 Bxd4 12. Be4 Bxe3 13. Qxe3 O-O 14. O-O-O { he controls both open files, and he intends to play next Rhe1, or f3-f4 with some pressure. It is not easy for Black to develop his Queenside. }) (7... O-O 8. Bh6 Bg4 { used to be a major alternative for Black, until the strong reply } (8... Bxh6 { is premature, as it allows White's Queen to take a threatening position on h6. After } 9. Qxh6 Nbd7 10. Ng5 { Black is in some danger: } 10... e5 11. d5 b4 12. Nd1 cxd5 13. Ne3 d4 14. Nd5 Bb7 15. Nxf6+ Nxf6 16. f4 { and White wins, thanks to the threat of O-O followed by Rxf6 later. }) (8... Nbd7 9. Bxg7 { White has nothing in the variation 9.e5 dxe5 10.dxe5 Ng4 11.Bxg7 Kxg7 this position is fine for Black, as shown in a few games. The point being that 12.Qf4 runs into the nice move Ndxe5 ! 13.Nxe5 Qd6 when thanks to the pin, Black gains back his piece with an excellent position. } 9... Kxg7 10. a4 { White provokes a weakening of Black's Queenside, before rerouting his Knight with Ne2-g3. There have been games played with } { White provokes a weakening of Black's Queenside, before rerouting his Knight with Ne2-g3. } 10... Bb7 { putting indirect pressure on e4. White replies with } (10... b4 11. Ne2 Qa5 { has been played in a few games some years ago, but it turns out that White has the powerful move } (11... c5 { is not recommended because of the reply } 12. e5 { kicking the black Knight away from its most natural square. } 12... dxe5 13. dxe5 Ng8 14. h4 { The attack only gained in strength with the pawn on e5. } 14... Bb7 15. Qe3 { Protecting the e5-pawn. } 15... Bxf3 16. gxf3 Qc7 17. f4 { The e5-pawn is solidly protected and h4-h5 is coming. } 17... c4 18. Be4 Rad8 19. h5 Nc5 20. Nd4 { White maintains the initiative as he has strong pressure on the h-file. }) (11... a5 12. Ng3 { What else can Black play? He cannot waste time with } 12... Kg8 { because after } (12... c5 13. e5 dxe5 14. dxe5 Ng8 15. h4 { with the idea of h4-h5 or Be4, looks pretty depressing for Black. }) (12... e5 { This is Black's main move. He prevents the idea e4-e5, and he puts a solid pawn stake in the center. } 13. Qg5 { White threatens to win the pawn on e5, while at the same time Nf5+ is annoying. While Black does not get enough compensation either after } { White threatens to win the pawn on e5, while at the same time Nf5+ is annoying. } { White threatens to win the pawn on e5, while Nf5+ is annoying at the same time. } 13... Qc7 (13... Kh8 14. dxe5 dxe5 15. Nxe5 Nxe5 16. Qxe5 Re8 17. Qg5) (13... exd4 14. Nf5+ Kg8 15. Nxd6 c5 16. O-O Ba6 { This position arrives almost by force after 13. Qg5. There had been a few games played in this position. The verdict is White retains a stable advantage, thanks to his control of the b5 and c4-squares and his central control. } { This position arrives almost by force after 13. Qg5. There have been a few games played in this position. The verdict is White retains a stable advantage, thanks to his control of the b5 and c4-squares and his central control. } 17. Nd2 { This is what White played in the latest correspondence game. He controls the c4-square even further, and he prepares the move f2-f4, gaining space on the Kingside. 17.Nb5!? is a good alternative, and it looks very attractive. } { This is what White played in the latest correspondence game. He controls the c4-square even further, and he prepares the move f2-f4, gaining space on the Kingside. } 17... Nh5 18. f4 Qxg5 19. fxg5 { White maintains a stable edge in the endgame thanks to his complete control of the Queenside light-squares. For example: } 19... Ne5 (19... Ng7 20. b3 Ne6 21. h4 Bxd3 22. cxd3 Ne5 23. N2c4 { Black cannot take the pawn on d3, as after } 23... Nxd3 24. g3 Rad8 25. Nb5 { The retreat squares on e5 and f4 are under White's control and the d3-Knight is trapped. }) (19... Bxd3 20. cxd3 f6 21. N2c4 fxg5 22. g3 { Preventing any ...Nh5-f4 counterplay. } 22... Ra6 23. Rxf8+ Kxf8 24. Nb7 { we are following the game Anokhin,Y -Rudenko,V ICCF email 2017. In the game Black managed to hold the draw, thanks to very stubborn resistance. However, I believe White has a very pleasant endgame. His Knights are on excellent squares, and he has a protected outside passed pawn after taking on a5. }) 20. Bxa6 Rxa6 21. N2c4 Nxc4 22. Nxc4 { This is clearly better for White, as his Knight on c4 cannot be challenged and the a5-pawn is a permanent weakness. }) 14. Nf5+ Kh8 15. Nxd6 Qxd6 16. dxe5 { simply wins a clean pawn. }) 13. h4 { he runs into a powerful attack } 13... h5 14. Nxh5 Nxh5 15. g4 Nhf6 16. h5 e5 17. hxg6 Nxg4 18. Nh4 fxg6 19. Nxg6 Re8 20. f3 Qf6 { And now I guess the simplest way for White to play is } 21. Nh4 { winning back his piece while achieving a winning position. }) 12. h4 { threatening to open the h-file with h4-h5. Black can reply } 12... h5 { but then he gives up an outpost for White's Knight on g5. } 13. O-O e5 14. Ng5 { White is ready to push his f-pawn forward. Black must defend very precisely in order to survive. } { White is ready to push his f-pawn forward. Black must defend very precisely in order to survive. After } 14... c5 (14... Ba6 { This is Black's most stubborn defence. } 15. f4 Bxd3 { is simply met by } (15... exf4 16. Rxf4 { followed by Raf1 is just plain bad for Black. }) (15... Rae8 16. Bxa6 { Maybe 16.f5 Ng4 17.Kh1 !? deserves attention as well. White's attack continues, and he plans to play next move Rf3 followed by Rdf1. } 16... Qxa6 17. dxe5 dxe5 18. f5 Qc4 { The black Queen has to help in the defence for the Kingside. } 19. b3 Qc5+ 20. Kh1 Qe7 21. Rad1 Nc5 22. Qxb4 Ncxe4 23. Qxe7 Rxe7 24. Kg1 { White still keeps a small advantage in the endgame, but not more. }) 16. cxd3 { when White still continues with f4-f5 next. }) 15. f4 cxd4 16. f5 { White's attack can get out of control, for example: } 16... Nc5 17. Ng3 Nxd3 18. cxd3 Qd8 19. Nxf7 Rxf7 (19... Kxf7 20. fxg6+ Kg7 21. Rxf6 Kxf6 22. Qh6 { and the threats of g7+, Nxh5+ and Rf1+ are too much for Black to defend against. }) 20. Qg5) 11. h4 h5 { Black had to prevent h4-h5 at all costs, but now his King's position and the g6-square are weakened. } 12. e5 { 12.O-O is the quiet and logical alternative. White has a safe and stable advantage. } 12... dxe5 13. dxe5 Ng4 14. e6 { And } 14... fxe6 { loses right away. } (14... Nde5 15. Nxe5 Nxe5 16. exf7 Rxf7 17. Ne4 { leads to a difficult position for Black. }) (14... Nc5 15. exf7 Rxf7 16. O-O-O { White keeps the initiative in this position. His Knight has a powerful square on g5 and Black's King's position is vulnerable. The game continued: } 16... e5 17. Ng5 Rxf2 18. Qe1 Qe7 19. Be2 Raf8 20. Bxg4 hxg4 21. Nce4 Nxe4 22. Nxe4 R2f4 23. g3 Rf3 24. h5 { Black's King is in serious danger. Squires,M -Arnold,H ICCF email 2017. }) 15. Bxg6) 9. h4 { was found. Then people stopped playing 8... Bg4 in practice. } 9... Nbd7 { when White just continues the attack: } (9... Bxf3 10. gxf3 { The doubled f-pawns support the White center nicely, while the open g-file makes his attack even more dangerous. } 10... Nbd7 { Black can't allow } (10... b4 11. Bxg7 Kxg7 12. Ne2 e5 13. Ng3 { The Knight supports the h4-h5 break. } 13... Nbd7 14. h5 exd4 15. O-O-O Kh8 16. f4 { White's threats on the Kingside are too strong. Black has no defence to the simple idea of hxg6 followed by f4-f5. }) (10... Nh5 { This is Black's best defence. If he allowed White to play h4-h5, the attack becomes too strong to handle, and it's almost game over. } 11. Bxg7 Kxg7 12. f4 Nd7 13. O-O-O { White is content with his space advantage and some pressure along the g-file. } 13... b4 14. Ne2 c5 15. Ng3 Nxg3 16. fxg3 cxd4 17. h5 Nc5 { And now probably the simplest way for White to get an advantage is } 18. Be2 Nxe4 19. Qxd4+ Nf6 20. g4 Qb6 21. g5 Qxd4 22. h6+ { A very important move. This cages Black's King on the backrank for the moment. } 22... Kg8 23. Rxd4 Nd7 24. Rxb4 Rfb8 25. Rxb8+ Rxb8 26. Rh3 { White has a clear advantage in the ending, thanks to his Queenside pawn majority. Also, his Bishop is slightly stronger than the Knight in this ending. }) 11. h5 e5 12. O-O-O { The attack along the g-and h-files is decisive. For example, } 12... exd4 13. Ne2 c5 14. hxg6 fxg6 15. Bxg7 Kxg7 16. Qh6+ Kf7 17. Bxb5 Ne5 18. f4 Neg4 19. Qh4 { led to a winning attack in Nemec,Z -Hlavica,B LSS email 2011. }) 10. h5 Bxh5 (10... Nxh5 11. Nh2 Be6 12. Bxg7 Kxg7 13. d5 cxd5 14. exd5 b4 15. Ne2 Bxd5 16. Ng4 { And White wins by force in all lines. } 16... f5 (16... Ndf6 17. Qh6+ Kh8 18. Nxf6 Nxf6 19. Nf4 { After } 19... Bc6 { the simplest win for White is } (19... e6 20. Nxd5 exd5 21. g4 { And not 21.O-O-O? because this gives Black time to defend with Rg8! 22.g4 Rg7 protecting the crucial h7 pawn. } 21... Re8+ 22. Kf1 Kg8 23. g5 Ne4 24. Re1 { And White is winning. The point being that } 24... Qxg5 { runs into } 25. Rxe4 { winning a clean piece. }) 20. Ne6 fxe6 21. Qxg6 { with the brutal threat of Rxh7 and mate. }) 17. Qh6+ Kg8 18. Ne3 e6 19. Nxd5 exd5 20. g4 { White has way too many threats, and I'd be really surprised if Black survives the onslaught. For example, after 20...Nhf6 20...fxg4 loses to 21.Rxh5 +- 21.gxf5 Qe7 Or 21...Ne5 22.O-O-O Qe7 23.Nf4 +- 22.fxg6 +- White's attack is too strong. }) 11. Bxg7 Kxg7 12. e5 Ng4 13. Rxh5 gxh5 14. Qg5+ Kh8 15. Qxh5 { wins very easily. }) 8. Bh6 { A good alternative for White is 8.a4 b4 9.Ne2 with the idea to support the center with c2-c3 followed by Ng3. He should also be slightly better in this case. } 8... Bxh6 9. Qxh6 e5 10. h3 { White controls the square g4 and he takes it away from Black's pieces. } 10... Qe7 11. O-O Bb7 12. Ne2 { The Knight is well-placed on g3. It protects the e4-pawn and White frees his c-pawn so that he can play c2-c3 or more aggressively, c2-c4. } 12... Ng8 13. Qd2 Ngf6 { Black managed to get rid of the annoying Queen on h6, but he didn't equalize. } 14. a4 a6 15. axb5 axb5 16. Rxa8+ Bxa8 17. Ra1 O-O 18. Qg5 { White intends to play Ng3 and c2-c3, supporting and solidifying his center. He has stable control over the position and the pressure along the a-file is quite annoying. }) 7. Bf4 { Against } 7... e5 { I like the simple reply } (7... O-O 8. h3 Nf6 9. Bh6 { when the move ...Ng4-f6, merely lost Black a tempo as we have gained the move h2-h3 for free. }) 8. Bg3 { keeping pressure on e5. The endgame arising after 8.dxe5 dxe5 9.Qxd8+ Kxd8 10.Bd2 Nd7 is not totally clear, as Black can be quite solid after ...Ke7 next move. It's not so easy for White to make progress in this ending. } 8... O-O 9. dxe5 Nxe5 10. O-O-O Nxf3 11. gxf3 d5 12. h4 h5 13. exd5 Qa5 14. Rg1 { Putting pressure on the g-file and later this Rook can come into the game with Rg5 etc. Here, even after Black's best defence: } 14... Bf5 15. Bd3 Bxd3 16. Qxd3 cxd5 17. Qxd5 Bxc3 18. bxc3 Qxd5 19. Rxd5 Nc6 20. Bf4 { the endgame remains quite difficult for him, because he is down a pawn and White is threatening both Rxh5, and Rd7. }) 6. O-O-O { now we can see the true idea behind the 150 Attack. White has a very easy plan of playing Bh6 followed by pushing the h-pawn, pry open the h-file then sac, sac, mate! @@StartBracket@@Fischer's comment on White's plan in the Dragon@@EndBracket@@. } 6... a6 (6... Ng4 7. Bg5 c5 8. dxc5 Qa5 { is Black's best hope for counterplay, but even then after } (8... Bxc3 9. Qxc3 Nxf2 { Black tries to complicate the nature of the game, but this doesn't work due to } 10. Rxd6 { taking advantage of the pin on the h4-d8 diagonal. } 10... Nd7 11. Bh6 e5 { 11...exd6 ?? gives you an additional rest day after 12.Qg7# } 12. Qe3 Nxh1 13. Bc4 { and after Nf3 next move, White's pieces are just way too active and his attack is unstoppable. }) 9. Bxe7 { Or 9.Nh3 protecting the f2-pawn and preparing to play f2-f3, kicking away the annoying enemy Knight on g4. Be6 10.a3 Bxc3 11.Qxc3 Qxc3 12.bxc3 f6 13.Bh4 when White has a stable edge in the endgame. } 9... Re8 (9... Bxc3 10. Qxc3 Qxc3 11. bxc3 Nxf2 12. Bxf8 Kxf8 13. cxd6 Be6 14. Be2 Nxh1 15. Rf1 Nc6 16. Nf3 Rd8 17. e5 { White retains some good chances to convert the ending, thanks to his extra pawn. }) 10. Bh4 Nc6 11. Kb1 { does not give Black enough compensation for his pawns, as White always has the move Nc3-d5, parrying the enemy attack. }) (6... c6 7. Bh6 Nbd7 (7... b5 8. f3 Qa5 { is met by } (8... b4 9. Nce2 Qa5 10. Kb1 { Now the white Knight can always protect a2 with the move Nc1, making it very hard for Black to cook up any sort of attack on the Queenside. } 10... c5 11. h4 { White's attack flows very smoothly towards its goal. } 11... Nc6 12. Bxg7 Kxg7 13. h5 { White's attack is just much faster: once the h-file is open, we get a variety of threats. } 13... cxd4 14. hxg6 fxg6 { Black needs to free the f7-square for his King. } 15. Qh6+ Kg8 16. Nxd4 { The move 16.Nh3 !? with the idea of Ng5, also deserves serious consideration. } 16... Nxd4 17. Rxd4 Be6 18. b3 { White has a slightly better pawn structure and his rooks very active; he has constant pressure along the h-file. } 18... Qc5 19. Bc4 { White's idea is that after } 19... Qxd4 (19... Bf7 20. Bxf7+ Rxf7 21. Qd2 { Gaining a tempo on the b4-pawn, while planning to bring the Knight to g5. } 21... a5 22. Nh3 Rff8 23. Ng5 Rfc8 24. f4 { White had a clear and stable advantage in Graf,H -Torgersen,T ICCF email 2019. He has strong pressure on the Kingside and threats including e4-e5, meanwhile, Black's attack on the Queenside will take a long time to achieve anything meaningful. }) 20. Bxe6+ Kh8 21. Ne2 { the threat of Nf4xg6 wins very quickly for White. }) 9. h4 b4 10. Nb1 { The Knight on b1 parries Black's counterattack, meanwhile White is quickly opening the h-file with h4-h5 next move. } 10... Qxa2 11. h5 Nbd7 12. Bxg7 Kxg7 { And now White has the precise continuation } 13. hxg6 { 13.g4 Nb6 14.b3 is another way to continue, and is also very strong. } 13... fxg6 14. Qh6+ Kf7 15. e5 { If White simply proceeds with 15.Nh3 Ke8 16.Ng5 , Black can go 16...Nb6 17.e5 Nfd5 when taking on h7 is no longer check, and after 18.exd6 Black has the strong resource 18...Na4 with counterplay. } 15... dxe5 16. Nh3 Ke8 17. Ng5 { when the complications work very well in White's favour. In the worst case he has a stable advantage, as he can always regain his sacrificed pawn by taking on h7. And he even has ideas like Bd3xg6 in some cases. }) 8. h4 e5 9. f3 exd4 (9... Bxh6 10. Qxh6 exd4 11. Rxd4 Ne5 12. g4 Ne8 13. Be2 { with a clear advantage in Konstantinov,M -Leupold,V ICCF email 2018. }) 10. Bxg7 dxc3 11. Qh6 cxb2+ { is simply met by } (11... Re8 12. h5 { leaves White with a dominating position as well. }) 12. Kb1 { when the pawn on b2 merely shields the white King from any attack. }) 7. f3 b5 8. Bh6 { followed by a quick h4-h5, it's hard to believe that Black will be able to survive the Kingside onslaught. } { followed by h4-h5 looks bad for Black. }) 5. Bg5 h6 6. Bh4 g5 7. Bg3 Bg7 { Black only succeeded in weakening his Kingside. } 8. h3 Nf6 9. e5 *",
        alias: 'pircs',
        trainAs: 'white',
      });

      this.selectSubrepertoire(0);
      // this.handleLearn();
      this.chessSrs.next();
      this.chessSrs.succeed();

      this.chessSrs.next();
      this.chessSrs.succeed();
      this.chessSrs.next();
      this.chessSrs.succeed();
      this.chessSrs.next();
      this.chessSrs.succeed();
      this.chessSrs.next();
      this.chessSrs.succeed();
      this.chessSrs.next();
      this.chessSrs.succeed();
      this.chessSrs.setMethod('learn');
      this.handleLearn();

      this.lastFeedback = 'init';
    
      // initialize num due cache
      this.numDueCache = new Array(this.chessSrs.state.repertoire.length).fill(0); 
      console.log(this.numDueCache);
      // TODO remove me 
      this.redraw();
    });
  }

  // resets subrepertoire-specific context,
  // e.x. for selecting a different subrepertoire for training
  clearSubrepertoireContext = () => {
    this.lastFeedback = 'init';
    //TODO do automatic recall/learn
    // reset board
    this.chessground?.set({
      fen: initial,
      drawable: {
        autoShapes: [],
      },
    });
  };

  // update PGN view context through this method since it will also handle setting chessground
  updatePgnViewContext = (ctx: PgnViewContext) => {
    this.pgnViewContext = {
      ...this.pgnViewContext,
      ...ctx,
    };
  };

  //TODO should be handled by ChessSrs library
  subrep = () => {
    return this.chessSrs.state.repertoire[this.chessSrs.state.index];
  };


  
  //TODO PGN validation
  addSubrepertoire = (newSubrep: NewSubrepertoire) => {
    this.chessSrs.addSubrepertoires(newSubrep.pgn, newSubrep.trainAs);
    this.subrepertoireNames.push(newSubrep.alias);
    this.redraw();
  };

  selectSubrepertoire = (which: number) => {
    if (which == this.chessSrs.state.index) return;
    this.chessSrs.load(which);

    this.clearSubrepertoireContext();
    this.redraw();
    this.chessground?.setAutoShapes([]);
  };

  toggleAddingNewSubrep = () => {
    this.addingNewSubrep = this.addingNewSubrep ? false : true;
    this.redraw();
  };

  jump = (index: number) => {
    this.pathIndex = index;
    const opts = this.makeCgOpts();
    console.log(opts);
    this.chessground!.set(opts);
    this.redraw();
  };

  atLast = () => {
    return this.pathIndex === this.path.length - 2;
  };

  makeCgOpts = (): CgConfig => {
    const fen = this.chessSrs.path()?.at(-2)?.data.fen || initial;

    console.log("comments", this.chessSrs.path()?.at(-1)?.data.comments)

    const targetSan = this.chessSrs.path()?.at(-1)?.data.san;
    const uci = calcTarget(fen, targetSan!);

    console.log(this.chessSrs.path()?.at(-2)?.data.fen);

    const config: CgConfig = {
      fen: this.path[this.pathIndex] || initial,

      turnColor: this.subrep().meta.trainAs,
      movable: {
        dests: this.atLast()
          ? this.chessSrs.state.method === 'learn'
            ? toDestMap(uci[0], uci[1])
            : fenToDests(fen)
          : new Map(),
        events: {
          after: (from: Key, to: Key) => {
            console.log('------------------------------');
            console.log('moved');
            if (this.atLast()) {
              switch (this.chessSrs.state.method) {
                case 'learn':
                  console.log('learned');
                  this.chessSrs.succeed();
                  this.handleLearn();
                  break;
                case 'recall':
                  const san = chessgroundToSan(fen, from, to);
                  //TODO be more permissive depending on config
                  switch (this.chessSrs.guess(san)) {
                    case 'success':
                      this.chessSrs.succeed();
                      this.handleRecall();
                      break;
                    case 'alternate':
                      this.chessSrs.succeed();
                      this.handleRecall();
                      break;
                    case 'failure':
                      this.handleFail(san);
                      break;
                  }
                  break;
              }
            }
          },
        },
      },
      drawable: {
        autoShapes:
          this.chessSrs.state.method === 'learn' ? [{ orig: uci[0], dest: uci[1], brush: 'green' }] : [],
      },
    };
    return config;
  };

  handleLearn = () => {
    this.chessSrs.update();
    this.lastFeedback = 'learn';
    console.log('handleLearn');
    this.chessSrs.setMethod('learn');
    this.chessSrs.next(); // mutates path
    // update path and pathIndex
    this.path = this.chessSrs.path()!.map((p) => p.data.fen);
    this.pathIndex = this.path.length - 2;
    const opts = this.makeCgOpts();
    console.log(opts);
    this.chessground!.set(opts);
    console.log(this.chessground!.state);

    this.redraw();
  };

  handleFail = (attempt: string) => {
    console.log(attempt);
    this.lastFeedback = 'fail';
    this.redraw();
  };

  //TODO refactor common logic from learn, recall, into utility method
  handleRecall = () => {
    this.lastFeedback = 'recall';
    this.numDueCache[this.chessSrs.state.index] = this.chessSrs.countDue();

    this.chessground?.setAutoShapes([]);
    this.chessSrs.setMethod('recall');
    this.chessSrs.update();
    this.chessSrs.next();

    this.path = this.chessSrs.path()!.map((p) => p.data.fen);
    this.pathIndex = this.path.length - 2;

    const opts = this.makeCgOpts();
    console.log(opts);
    this.chessground!.set(opts);
    console.log();

    this.redraw();
  };
}
